Ext.define("Hc_Common.model.Base",{extend:"Ext.data.Model"});
Ext.define("Hc_Common.model.MaterialSize",{extend:"Ext.data.Model",fields:[{name:"f1",allowNull:true},{name:"f2",allowNull:true},{name:"f3",allowNull:true},{name:"f4",allowNull:true},{name:"f5",allowNull:true},{name:"f6",allowNull:true},{name:"f7",allowNull:true},{name:"f8",allowNull:true},{name:"f9",allowNull:true},{name:"f10",allowNull:true},{name:"f11",allowNull:true},{name:"f12",allowNull:true},{name:"f13",allowNull:true},{name:"f14",allowNull:true},{name:"f15",allowNull:true},{name:"f16",allowNull:true},{name:"f17",allowNull:true},{name:"f18",allowNull:true},{name:"f19",allowNull:true},{name:"f20",allowNull:true}]});
Ext.define("Hc_Common.store.Base",{extend:"Ext.data.Store",alias:"store.basestore",buffered:false,autoLoad:false,remoteSort:true,remoteFilter:true,proxy:{type:"ajax",reader:{type:"json",rootProperty:"list",totalProperty:"totalCount"},writer:{type:"json",writeAllFields:true,rootProperty:"items"},actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},pageParam:"pageNum",limitParam:"pageSize",startParam:""},listeners:{beforeload:function(a){var c=a.getSorters();if(c&&c.items.length>0){var b=[];Ext.Array.each(c.items,function(d){b.push(d.getProperty()+" "+d.getDirection().toLowerCase())});a.proxy.extraParams.sort=b.join(",")}else{delete a.proxy.extraParams.sort}},load:function(c,b,g,f){if(f.success){var j=f.getResponse();if(!j){Hc.alert("访问服务器异常,请与系统管理员联系");return}var a=j.responseText;try{a=JSON.parse(a);if(a.result){if(a.result.resultCode!=0){Hc.alert(a.result.msg,function(){if(a.result.resultCode=="timeout"){location.href=Hc.basePath+"logout.json"}})}}}catch(h){Hc.alert("服务器返回不是有效的JSON数据")}}else{try{var i=JSON.parse(f.error.response.responseText);Hc.alert(i.result.msg)}catch(h){console.dir(h)}}}}});
Ext.define("Hc_Common.store.ComBase",{extend:"Hc_Common.store.Base",alias:"store.combasestore",autoLoad:true,remoteSort:false,remoteFilter:false,proxy:{type:"ajax",reader:{type:"json",rootProperty:"list",totalProperty:"totalCount"}}});
Ext.define("Hc_Common.store.NoajaxComBase",{extend:"Ext.data.Store",alias:"store.noajaxstore",autoLoad:true,proxy:{type:"ajax",},msgTip:null,constructor:function(){var b=this,c;b.callParent(arguments);var a=Ext.create("Hc_Common.store.Noajax");a.setUrl(b.getProxy().getUrl());this.setProxy(a);b.getData().addObserver(this);c=b.inlineData;if(c){delete b.inlineData;b.loadInlineData(c)}}});Ext.define("Hc_Common.store.Noajax",{extend:"Ext.data.proxy.Ajax",requires:["Ext.Ajax"],alias:"store.noajax",async:false,reader:{type:"json",rootProperty:"list",totalProperty:"totalCount"},sendRequest:function(c){var b=this;var a=c.getCurrentConfig();a.async=b.async;c.setRawRequest(Ext.Ajax.request(a));this.lastRequest=c;return c}});
Ext.define("Hc_Framework.store.TreeBase",{extend:"Ext.data.TreeStore",alias:"store.treebase",autoLoad:true,buffered:false,proxy:{type:"ajax",reader:{type:"json",rootProperty:"list"},actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"}},nodeParam:"id",parentProperty:"parentId",pageParam:"pageNum",limitParam:"pageSize",listeners:{beforeload:function(a,d){var c=a.getSorters();if(c&&c.items.length>0){var b=[];Ext.Array.each(c.items,function(e){b.push(e.getProperty()+" "+e.getDirection().toLowerCase())});a.proxy.extraParams.sort=b.join(",")}else{delete a.proxy.extraParams.sort}a.pageSize=5000}}});
Ext.define("Hc_Common.store.CmnBrandRelation",{extend:"Hc_Common.store.ComBase",alias:"store.cmnbrandrelation",fields:[{name:"brandNo",text:"品牌编号",type:"string"},{name:"brandCode",text:"品牌编码",type:"string"},{name:"brandEname",text:"品牌英文名",type:"string"},{name:"brandCname",text:"品牌中文名",type:"string"},{name:"divisionNo",text:"事业部编号",type:"string"},{name:"divisionName",text:"事业部名称",type:"string"}],autoLoad:true,proxy:{url:Hc.mdmPath+"bas_brand_relation/listvoAll.json?selectVoName=brdRltnSelectListByVoAll"}});
Ext.define("Hc_Common.store.CmnDict",{extend:"Hc_Common.store.ComBase",alias:"store.cmndict",fields:[{name:"itemCode",text:"明细编码",type:"string"},{name:"itemName",text:"明细名称",type:"string"},{name:"displayName",text:"显示名称",type:"string"}],proxy:{url:Hc.mdmPath+"bas_dict/listAll.json"}});
Ext.define("Hc_Common.store.CmnDivision",{extend:"Hc_Common.store.ComBase",alias:"store.cmndivision",fields:[{name:"divisionNo",text:"事业部编号",type:"string"},{name:"divisionName",text:"事业部名称",type:"string"}],proxy:{url:Hc.mdmPath+"bas_division/listAll.json"}});
Ext.define("Hc_Common.store.CmnFactory",{extend:"Hc_Common.store.ComBase",alias:"store.cmnfactory",fields:[{name:"factoryNo",text:"厂区编号",type:"string"},{name:"factoryName",text:"厂区名称",type:"string"}],proxy:{url:Hc.mdmPath+"bas_factory/listAll.json?enableFlag=1"}});
Ext.define("Hc_Common.store.CmnWarehouse",{extend:"Hc_Common.store.ComBase",alias:"store.cmnwarehouse",fields:[{name:"storeNo",text:"仓库编号",type:"string"},{name:"storeName",text:"仓库名称",type:"string"}],proxy:{url:Hc.mdmPath+"bas_store/listAll.json?enableFlag=1"}});
Ext.define("Hc_Common.view.BasePage",{extend:"Ext.container.Container",controller:"basepage",viewModel:{type:"basepage"},referenceHolder:true,moduleId:"",moduleName:"",isReadOnly:false,pageSize:25,isAutoLoad:false,editStatus:0,auditStatus:20,userCode:"",userName:"",pageType:"",moduleRight:511,userRight:511,initComponent:function(){this.callParent()}});
Ext.define("Hc_Common.view.BasePageController",{extend:"Ext.app.ViewController",alias:"controller.basepage",viewRight:1,editRight:2,addRight:4,deleteRight:8,RFRight:16,printRight:32,exportRight:64,printSetupRight:128,auditRight:256,giveRight:512,otherRight1:1024,otherRight2:2048,otherRight3:4096,otherRight4:8192,otherRight5:16384,editingList:null,workObject:null,_isAfterSave:false,_idValue:"",init:function(){var a=this;a.editingList=[];a._isAfterSave=false;a._idValue="";a.getRightKey();a.callParent()},getRightKey:function(){},hasRight:function(a){return(this.view.userRight&a)==a},canView:function(){return this.hasRight(this.viewRight)},canAdd:function(){return this.hasRight(this.addRight)},canEdit:function(){return this.hasRight(this.editRight)},canDelete:function(){return this.hasRight(this.deleteRight)},canPrint:function(){return this.hasRight(this.printRight)},canExport:function(){return this.hasRight(this.exportRight)},canAudit:function(){return this.hasRight(this.auditRight)},canGiveRight:function(){return this.hasRight(this.giveRight)},getUserCode:function(){return this.view.userCode},getUserName:function(){return this.view.userName},callServer:function(a){Ext.Ajax.request(a)},saveData:function(b){var c=this;if(!b.srcObj){Hc.alert("没有指定源对象");return}var a=b.url||b.srcObj.batchUrl;if(!a){Hc.alert("没的指定后端服务URL");return}if(!b.data){Hc.alert("无数据需保存");return}if(b.btn){b.btn.setDisabled(true)}var d={url:a,method:"POST",success:function(g){try{var f=JSON.parse(g.responseText);if(f.result.resultCode=="0"){c.editingList=[];c._isAfterSave=true;if(f.masterId){c._idValue=f.masterId}}c.afterSave(f,b)}catch(h){Hc.show({title:"错误提示",msg:h,height:300,width:500})}},failure:function(e){Hc.show({title:"错误提示",msg:e.responseText,height:300,width:500});if(b.btn){b.btn.setDisabled(false)}}};if(b.isJson===false){d.params=JSON.stringify(b.data)}else{d.jsonData=JSON.stringify(b.data)}c.callServer(d)},afterSave:function(a,b){if(b.btn){b.btn.setDisabled(false)}},getGridDirtyData:function(d){var c={},h=d.store,f=h.getModifiedRecords(),e=d.modelName.substr(d.modelName.lastIndexOf(".")+1),g="",i=[],b=[],a=[];Ext.Array.each(f,function(j){g=j.get("_flag");if(g=="A"){i.push(j.data)}else{if(g=="D"){a.push(j.data)}else{b.push(j.data)}}});c.customerName=e;if(d.mSizeIdx>-1){c.isSizeHorizontal=1;c.qtyProperty=d.mSizeQtyField}if(d.convertToSize==1){c.type=1}if(i.length>0){c.insertList=i}if(a.length>0){c.deleteList=a}if(b.length>0){c.updateList=b}return c},getDataToSave:function(h,g){var n=this,d={},e=h.subGrid||[];if(!n.validData(h)){return false}if(e.length==0){if(h.is("form")){var j=h.getRecord();d.customerName=h.modelName.substr(h.modelName.lastIndexOf(".")+1);if(g){d.deleteList=[j.data]}else{if(j.phantom){d.insertList=[j.data]}else{d.updateList=[j.data]}}}else{d=n.getGridDirtyData(h)}return d}var a=h.primaryKey,m=[],o=n.getObjList();d.idFieldName=a;if(h.is("form")){var j=h.getRecord();if(g){d.operateType="deleted"}else{if(!h.isDirty()){d.operateType="nochanged"}else{if(j.phantom){d.operateType="inserted"}else{d.operateType="updated"}}}d.masterJson=j.data}else{var p=h.store,l=p.getModifiedRecords();if(l.length<1){d.operateType="nochanged";l=h.getSelection();if(l.length<1){Hc.alert("操作异常!");return false}d.masterJson=l[0].data}else{var q=l[0];var k=q.get("_flag");if(k=="A"){d.operateType="inserted"}else{if(k=="D"){d.operateType="deleted"}else{d.operateType="updated"}}d.masterJson=q.data}}for(var f=0;f<e.length;f++){var c=o[e[f]];if(!c){continue}if(d.operateType=="deleted"){var b={};b[a]=d.masterJson[a];m.push({customerName:c.modelName.substr(c.modelName.lastIndexOf(".")+1),deleteList:[b]})}else{if(c.isUpdating){m.push(n.getGridDirtyData(c))}}}if(m.length>0){d.customerListData=m}if(d.operateType=="updated"||d.operateType=="nochanged"){n._idValue=d.masterJson[a]}return d},keyValueError:function(c){var a=function(){c.record.set(c.field,c.originalValue);if(c.grid.editModel=="cell"){c.grid.editingPlugin.startEditByPosition({row:c.rowIdx,column:c.colIdx})}else{c.grid.editingPlugin.startEdit(c.rowIdx,c.colIdx)}};if(c.field==c.grid.primaryKey){Hc.alert("新输入的主键【"+c.value+"】已存在",function(){a()})}else{var d="",b=c.grid.unionKey.split(",");Ext.each(b,function(e){d+=" 【"+(c.record.get(e)||"")+"】 "});Hc.alert("唯一索引值"+d+"已存在",function(){a()})}},checkKeyValue:function(g){var h=this,c=(g.grid.unionKey||"").split(",");if((g.field==g.grid.primaryKey||c.indexOf(g.field)>=0)&&g.value!=g.originalValue){var j=0,b,i=g.grid.store;var f=function(e){h.callServer({url:i.proxy.url,method:"POST",params:{queryCondition:JSON.stringify(e)},success:function(l){var k=JSON.parse(l.responseText);if(k.list&&k.list.length>0){h.keyValueError(g)}}})};if(g.field==g.grid.primaryKey){j=i.findBy(function(e){return e.get(g.field)==g.value&&e!=g.record});if(j>-1){h.keyValueError(g)}else{b=[{property:g.field,value:g.value,operator:10}];f(b)}}else{var d,a;j=i.findBy(function(e){d=[];a=[];Ext.each(c,function(l){d.push(e.get(l));a.push(g.record.get(l))});return Ext.Array.equals(d,a)&&e!=g.record});if(j>-1){h.keyValueError(g)}else{b=[];Ext.each(c,function(e){b.push({property:e,value:g.record.get(e),operator:10})});b.push({property:g.grid.primaryKey,value:g.record.get(g.grid.primaryKey),operator:16});f(b)}}}},gridValidData:function(c){var b=c.columns,d,a,f=true,e=c.store.getModifiedRecords();if(Ext.isEmpty(e)){return true}for(a=0;a<b.length;a++){d=b[a].getEditor&&b[a].getEditor();if(!d){continue}if(d.allowBlank===false){if(Ext.Array.some(e,function(g){return Ext.isEmpty(g.get(b[a].dataIndex))&&g.get("_flag")!="D"})){f=false;Hc.alert("【"+b[a].text+"】列数据不能为空");break}}}return f},validData:function(f){var c=this,a,d=true,b,e=f.subGrid||[];if(Ext.isString(f)){f=c.getObj(f)}if(f.is("form")){d=f.isValid()}else{if(f.is("grid")){d=c.gridValidData(f)}}if(d&&e.length>0){for(a=0;a<e.length;a++){b=c.getObj(e[a]);if(!b||!b.is("grid")){continue}d=c.gridValidData(b);if(!d){break}}}return d},gridSelectionChange:function(d,h){var g=this,f=h[0],a=g.getObjList(),c=d.view.grid,b=c.reference;if(g.canDelete()&&a.btnDelete&&c.isCanDelete&&!c.isReadOnly){a.btnDelete.setDisabled(h.length===0)}if(g.canPrint()&&a.btnPrint){a.btnPrint.setDisabled(h.length===0)}if(g.canAudit()&&a.btnAudit){a.btnAudit.setDisabled(h.length===0&&c.isUpdating)}g.bindSubGrid(d.view.grid);if(b=="mastergrid"){b="grid"}if(!f){f=Ext.create(d.view.grid.modelName)}g.getViewModel().set(b+"Row",f)},gridDataChanged:function(b,c){var d=this,a=d.getObjList();if(typeof c=="string"){c=a[c]}if(c.isReadOnly){return}var e=d.getDirtyIndex(b)>-1;c.isUpdating=e;if(e){d._isAfterSave=false}if(e){Ext.Array.include(d.editingList,c.reference)}else{Ext.Array.remove(d.editingList,c.reference)}if(a.btnSave){a.btnSave.setDisabled(d.editingList.length==0)}if(a.btnCancel){a.btnCancel.setDisabled(d.editingList.length==0)}if(a.btnUndo){a.btnUndo.setDisabled(d.editingList.length==0)}if(a.btnAudit&&e){a.btnAudit.setDisabled(true)}c.view.refresh()},gridCannotEditKeyField:function(a){if(!this.canAdd()&&!this.canEdit()){return false}if(a.grid.isReadOnly==true){return false}if(a.field==a.grid.primaryKey&&!a.record.phantom){return false}if(!a.grid.isCanEdit&&!a.record.phantom){return false}},bindSubGrid:function(g){if(typeof g=="string"){g=this.getObj(g)}var f=g.subGrid||[];if(f.length==0){return}var e,b="",h=this.getObjList(),c=g.primaryKey;if(g.is("form")){e=g.getRecord()}else{e=g.getSelection()[0]}if(e&&!e.phantom){b=e.get(c)}for(var d=0;d<f.length;d++){var a=h[f[d]].store;if(b){a.proxy.extraParams[c]=b;a.reload()}else{a.removeAll();a.commitChanges()}}},gridIsCanLoad:function(a,f){if(this._isAfterSave){return true}if(typeof f=="string"){f=this.getObj(f)}if(this.getDirtyIndex(a)>-1||(f.isMaster&&this.editingList.length>0)){Hc.alert("您正在编辑数据,请先保存或取消后再进行此操作");return false}var d=f.supGrid;if(d){var c=this.getObj(d),b=c.primaryKey,e=c.getSelection()[0];if(!e||e.phantom){return false}a.proxy.extraParams[b]=e.get(b)}},gridHeadCls:function(b){var a=b.vcolumn,g=b.headerCt,h,d,f,e;for(h=0;h<a.length;h++){d=a[h].editor;e=a[h].dataIndex;if(!d||!e){continue}f=Ext.Array.findBy(g.items.items,function(c){return c.dataIndex==e});if(!f){continue}if(d.allowBlank===false){f.addCls("notnull-field")}else{f.addCls("cannull-field")}}},setSizeColsOnLoad:function(g,d,f){var h=this;if(g.mSizeIdx==-1){return}try{var a=JSON.parse(f.getResponse().responseText),c=a.headlist||[],b=a.usedlist||[];h.setGridHeadList(g,c,b);h.setGridSizeCols(g,d)}catch(i){console.info("Error:",i)}},setSizeColsOnEdit:function(a,c){if(c.field!=="materialNo"||a.mSizeIdx==-1){return}if(c.value==c.originalValue){return}if(a.store.findBy(function(d){return d.get("materialNo")==c.value&&d!=c.record})>-1){Hc.alert("物料号【"+c.value+"】已存在",function(){c.record.set("materialNo","")});return}var b=this;if(b.setSizeFillFields(a,c)){b.setGridSizeCols(a,a.store);return}b.callServer({url:a.mSizeUrl,params:{materialNo:c.value},method:"POST",success:function(i){try{var e=JSON.parse(i.responseText),g=e.headlist||[],f=e.usedlist||[];if(Ext.isEmpty(g)){Hc.alert("无法获取物料【"+c.value+"】的尺码信息",function(){c.record.set("materialNo","")});return}b.setGridHeadList(a,g,f);b.setSizeFillFields(a,c);b.setGridSizeCols(a,a.store)}catch(h){console.info("通过物料读取尺码信息时出错:",h);Hc.alert("获取物料【"+c.value+"】的尺码信息出错",function(){c.record.set("materialNo","")})}},failure:function(e){console.info("通过物料读取尺码信息访问后端出错:",e.responseText);Hc.alert("读取物料尺码出错! 错误信息:"+e.responseText,function(){c.record.set("materialNo","")})}})},setGridSizeCols:function(a,d){var u=a.mSizeIdx;if(u==-1){return}var t=this,c=Hc.clone(a._headlist),s=Hc.clone(a.vcolumn),n,l,h,b;if(!c){return}for(n=1;n<21;n++){b="f"+n;if(!Ext.Array.findBy(c,function(e){return e[b]!="0"})){for(l=0;l<c.length;l++){h=c[l];delete h[b]}}}if(c.length==0){a.reconfigure(d,s);t.gridHeadCls(a);return}try{var k=[],o=s[u],m=a._uselist||[],p="numberfield";if(a.sizeInputType!="number"){p="textfield"}var g=function(e,i,j){i=i=="0"?"&nbsp;":(i||"&nbsp;");if(j){return{text:i,columns:[j]}}return{dataIndex:e,text:i,width:50,align:"center",editor:{xtype:p},renderer:function(x,w,v){if(Ext.Array.findBy(m,function(y){return y.materialNo==v.get("materialNo")&&(y[e]!="0")})){w.tdCls="x-grid-input-cell"}return x==0?"":x}}};if(c.length==1){h=c[0];k.push({text:h.sizeTypeNo,dataIndex:"sizetTypeNo",align:"center",width:"50"});for(n=1;n<21;n++){b="f"+n;if(!h[b]){continue}k.push(g(b,h[b]))}}else{var r,f={};for(n=1;n<21;n++){r={};b="f"+n;for(l=0;l<c.length;l++){h=c[l];if(n==1){if(l==0){f={text:h.sizeTypeNo,dataIndex:"sizeTypeNo",align:"center",width:"50"}}else{f={text:h.sizeTypeNo,columns:[f]}}}if(!h[b]){continue}if(l==0){r=g(b,h[b])}else{r=g(b,h[b],r)}}if(n==1){k.push(f)}if(Ext.Object.isEmpty(r)){continue}k.push(r)}}Ext.Array.insert(s,u,k);Ext.Array.remove(s,o);a.reconfigure(d,s);t.gridHeadCls(a)}catch(q){console.info("创建物料的尺码表头时出错:",q);Hc.alert("创建物料的尺码表头时出错")}},sizeFieldBeforeEdit:function(f,h){var g=f._uselist;if(f.mSizeIdx==-1){return}var a=[];for(var d=1;d<21;d++){a.push("f"+d)}if(a.indexOf(h.field)==-1){return}if(Ext.isEmpty(g)){return false}var c=h.record.get("materialNo");if(Ext.isEmpty(c)){return false}var b=Ext.Array.findBy(g,function(e){return e.materialNo==c});if(!b||!b[h.field]||b[h.field]=="0"){return false}},setGridHeadList:function(d,a,g){var c=0,b,f=Hc.clone(d._headlist||[]),e=Hc.clone(d._uselist||[]);if(!Ext.isEmpty(a)){for(c=0;c<a.length;c++){b=a[c];if(!b||!b.sizeTypeNo){continue}if(Ext.Array.findBy(f,function(h){return h.sizeTypeNo==b.sizeTypeNo})){continue}f.push(b)}d._headlist=f}if(!Ext.isEmpty(g)){for(c=0;c<g.length;c++){b=g[c];if(!b||!b.materialNo){continue}if(Ext.Array.findBy(e,function(h){return h.materialNo==b.materialNo})){continue}e.push(b)}d._uselist=e}},setSizeFillFields:function(d,h){var j=d._headlist||[],g=d._uselist||[],a=d.mSizeFillFields.split(","),b=Ext.Array.findBy(g,function(e){return e.materialNo==h.value});if(b&&Ext.Array.findBy(j,function(e){return e.sizeTypeNo==b.sizeTypeNo})){var c=0,f="";for(;c<a.length;c++){f=b[a[c]];if(f==null){f=""}h.record.set(a[c],f)}return true}return false},getObjList:function(){return this.getReferences()},getObj:function(a){return this.lookupReference(a)},getBodyHeight:function(b){var c=window.innerHeight,a=this.view.up("app-main");if(a){var d=a.down("maintop").getHeight();c=c-d-25}b=b||1;return c*b},initRowClass:function(b,d,e,c){var a=b.get("_flag");if(a=="A"){return"x-grid-rows-add"}if(a=="D"){return"x-grid-rows-delete"}if(b.dirty&&!a){return"x-grid-rows-edit"}return""},getFormItems:function(c,e){var a=[],d,f,b;if(c.length==0){return a}for(b=0;b<c.length;b++){f=c[b];d={name:f.dataIndex,fieldLabel:f.text||f.header,xtype:"textfield",bind:{value:"{"+e+"."+f.dataIndex+"}"}};if(Ext.isObject(f.editor)){Ext.apply(d,c[b].editor)}if(!f.editor){d.disabled=true}a.push(d)}return a},getDirtyIndex:function(a){return a.findBy(function(b){return b.dirty||b.phantom})},showInTab:function(b,g){if(!Ext.isObject(b)){Hc.alert("请正确传入参数,只接收对象参数!");return}var d=b.xtype,f=Ext.getCmp("maintabpanel");if(!Ext.ClassManager.getNameByAlias("widget."+d)){Hc.alert("模块名【"+d+"】不存在!");return}if(!f){var e=b.title;delete b.title;Ext.apply(b,{height:Ext.getBody().getHeight()*0.8,width:Ext.getBody().getWidth()*0.8});this.showInWin(b,{title:e,winName:b.itemId,showBbar:false});return}var a=f.getComponent(b.itemId);if(!a){var c={closable:true,reorderable:true,loadMask:"加载中..."};Ext.apply(c,b);a=f.add(c)}else{Ext.apply(a,b);if(g&&a.controller){a.controller.init()}}f.setActiveTab(a)},showInWin:function(b,a){if(!Ext.isObject(b)){Hc.alert("请正确传入参数,第一个参数只接收对象!");return}var d=b.xtype,c=this;if(!Ext.ClassManager.getNameByAlias("widget."+d)){Hc.alert("类名【"+d+"】不存在!");return}var f={closeAction:"destroy",modal:true,constrain:true,items:[b],autoShow:true,bbar:["->",{xtype:"button",text:a.confirmText||"确认",handler:c.onWinConfirmClick,scope:c,glyph:Hc.Icon.btnSave},{xtype:"button",text:a.cancelText||"取消",handler:c.onWinClose,scope:c,glyph:Hc.Icon.btnCancel}]};Ext.apply(f,a);if(a.showBbar===false){delete f.bbar}var e=Ext.widget("window",f);return e},onWinConfirmClick:function(a){a.up("window").close()},onWinClose:function(a){a.up("window").close()},renderYesNo:function(g,b,e,f,d,c,a){return g?"是":"否"},renderUseFlag:function(g,b,e,f,d,c,a){return g?"启用":"禁用"},onBeforeDestroy:function(){if(this.editingList.length>0){if(!confirm("正在编辑数据,是否退出？")){return false}}}});
Ext.define("Hc_Common.view.BasePageModel",{extend:"Ext.app.ViewModel",alias:"viewmodel.basepage"});
Ext.define("Hc_Common.view.BaseSimplePage",{extend:"Hc_Common.view.BasePage",controller:"basesimplepage",viewModel:{type:"basesimplepage"},layout:"border",customLayout:false,otherItems:null,fieldWidth:"100%",labelWidth:80,labelAlign:"right",toolbarRegion:"north",toolbar:{xtype:"toolbar",reference:"commontoolbar",region:"",items:[{text:"查询",itemId:"btnSearch",reference:"btnSearch",handler:"onBtnSearchClick",glyph:Hc.Icon.btnSearch},{text:"重置",itemId:"btnReset",reference:"btnReset",handler:"onBtnResetClick",glyph:Hc.Icon.btnReset},{text:"过滤",icon:"./resources/static/js/extjs/packages/ext-theme-classic/images/grid/filters/find.png",itemId:"btnFilter",reference:"btnFilter",xtype:"splitbutton",menu:[{text:"本页",itemId:"btnFilterLocal",reference:"btnFilterLocal",handler:"onSetFilterLocal"},{text:"所有",itemId:"btnServer",reference:"btnFilterServer",handler:"onSetFilterServer"},{text:"关闭",itemId:"btnFilterClose",reference:"btnFilterClose",handler:"onFilterClose"}]},{xtype:"tbseparator",reference:"commontoolsp1"},{xtype:"splitbutton",text:"新增",itemId:"btnAdd",reference:"btnAdd",handler:"onBtnAddClick",glyph:Hc.Icon.btnAdd,menu:[{text:"批量导入",itemId:"btnImport",reference:"btnImport",handler:"onBtnImportClick",glyph:Hc.Icon.btnImport},{text:"复制记录",itemId:"btnCopy",reference:"btnCopy",handler:"onBtnCopyClick",glyph:Hc.Icon.btnCopy}]},{text:"编辑",itemId:"btnEdit",reference:"btnEdit",handler:"onBtnEditClick",glyph:Hc.Icon.btnEdit,hidden:true},{text:"删除",itemId:"btnDelete",reference:"btnDelete",handler:"onBtnDeleteClick",glyph:Hc.Icon.btnDelete,disabled:true},{xtype:"tbseparator",reference:"commontoolsp2"},{text:"还原",itemId:"btnUndo",reference:"btnUndo",handler:"onBtnUndoClick",glyph:Hc.Icon.btnUndo,disabled:true},{text:"取消",itemId:"btnCancel",reference:"btnCancel",handler:"onBtnCancelClick",glyph:Hc.Icon.btnCancel,disabled:true},{xtype:"tbseparator",reference:"commontoolsp3"},{text:"保存",itemId:"btnSave",reference:"btnSave",handler:"onBtnSaveClick",glyph:Hc.Icon.btnSave,disabled:true},{text:"审批",itemId:"btnAudit",reference:"btnAudit",handler:"onBtnAuditClick",glyph:Hc.Icon.btnAudit,hidden:true,disabled:true},{xtype:"tbseparator",reference:"commontoolsp4"},{xtype:"splitbutton",text:"导出",itemId:"btnExport",reference:"btnExport",handler:"onBtnExportPageClick",glyph:Hc.Icon.btnExport,menu:[{text:"导出当前页",itemId:"btnExportPage",reference:"btnExportPage",handler:"onBtnExportPageClick"},{text:"导出全部",itemId:"btnExportAll",reference:"btnExportAll",handler:"onBtnExportAllClick"}]},{xtype:"tbseparator",reference:"commontoolsp5"},{text:"打印",itemId:"btnPrint",reference:"btnPrint",handler:"onBtnPrintClick",glyph:Hc.Icon.btnPrint,disabled:true},{xtype:"tbseparator",reference:"commontoolsp6"},{text:"更多",itemId:"btnOther",reference:"btnOther",xtype:"splitbutton",glyph:Hc.Icon.btnOther,menu:[{text:"查看日志",itemId:"btnViewLog",reference:"btnViewLog",handler:"onBtnViewLog"},{text:"批量更改列值",itemId:"btnBatchModify",reference:"btnBatchModify",handler:"onBtnBatchModifyClick"}]},{text:"功能1",itemId:"btnOther1",reference:"btnOther1",handler:"onBtnOther1",hidden:true},{text:"功能2",itemId:"btnOther2",reference:"btnOther2",handler:"onBtnOther2",hidden:true},{text:"功能3",itemId:"btnOther3",reference:"btnOther3",handler:"onBtnOther3",hidden:true},{text:"功能4",itemId:"btnOther4",reference:"btnOther4",handler:"onBtnOther4",hidden:true},{text:"功能5",itemId:"btnOther5",reference:"btnOther5",handler:"onBtnOther5",hidden:true}]},billStatusUrl:"",billStatusKey:"",billStatusData:null,billNoText:"单据编号",billStatusText:"单据状态",gridHasOrderNo:true,searchItems:[],searchColumn:4,searchNotNullField:"",searchPanel:{xtype:"form",region:"north",reference:"commonsearch",collapsible:true,collapseMode:"undefined",title:"查询面板",layout:{type:"table"},header:{height:20,padding:0},defaults:{},defaultType:"textfield",bodyPadding:3,autoScroll:true,items:[]},gridModel:"",gridColumns:[],gridEditModel:"cell",gridCanDrag:false,gridCanEdit:true,gridCanAdd:true,gridCanDelete:true,gridReadOnly:false,gridPrimaryKey:"",gridUnionKey:"",gridRegion:"center",gridIsMaster:false,gridSupGrid:"",gridSubGrid:[],gridAuditUrl:"",gridFilterStatus:true,gridFilterType:true,gridPlugins:[],gridSelModel:"MULTI",gridCanDeSelect:true,gridLoadUrl:"",gridSaveUrl:"",gridExportUrl:"",gridImportUrl:"",gridTitle:"",gridMSizeIdx:-1,gridMSizeUrl:Hc.sdsPath+"bl_co_dtl/listvo.json?selectVoName=SelectListByVoBlCoMaterial",gridMSizeQtyField:"sizeQty",gridMSizeFillField:"materialName,sizeTypeNo",gridSizeInputType:"number",gridMConvertSize:0,gridHasMark:true,gridHasCreator:true,gridHasModifier:true,gridHasAuditor:false,grid:{xtype:"grid",reference:"mastergrid",columnLines:true,columns:[],region:"",layout:"fit",bbar:{xtype:"pagingtoolbar",displayInfo:true},viewConfig:{enableTextSelection:true},selModel:{}},gridcolNames:"",gridmustArray:"",gridisValidateAll:"",gridmainKey:"",gridvalidationConditions:"",gridfileName:"grid.xls",gridfileType:".xls",gridexportColumns:"",gridEditColumn:0,gridEditItems:[],gridEditHeight:-1,gridEditLayout:"table",editPanel:{xtype:"form",region:"south",split:true,reference:"commonedit",border:false,autoScroll:true,defaults:{},layout:{},bodyPadding:3,items:[]},pageType:"simple",gridLogWinTitle:"",gridLogLoadUrl:"",initComponent:function(){var d=this;if(!d.gridModel){Hc.alert("必须此定网格对应的数据模型gridModel属性");d.callParent();return}d.toolbar.region=d.toolbarRegion;d.grid.region=d.gridRegion;if(d.gridReadOnly){d.gridCanAdd=false;d.gridCanDelete=false;d.gridCanEdit=false}else{if(!d.gridCanAdd&&!d.gridCanDelete&&!d.gridCanEdit){d.gridReadOnly=true}}var a=Ext.create("Hc_Common.store.Base",{model:d.gridModel,autoLoad:d.isAutoLoad,pageSize:d.pageSize,proxy:{url:d.gridLoadUrl}});d.grid.store=a;d.grid.bbar.store=a;d.grid.bbar.plugins=Ext.create("Ext.ux.ComboPageSize",{defaultSize:d.pageSize});var f=Hc.clone(d.gridColumns);if(d.pageType=="billList"){f=[{text:d.billStatusText,dataIndex:"billStatus",width:60,renderer:function(i){if(Ext.isEmpty(i)){return i}var j=d.lookupReference("ddlBillStatus");if(!j){return i}var e=j.store.findExact(j.valueField,i.toString());return e>-1?j.store.getAt(e).get(j.displayField):i}},{text:d.billNoText,dataIndex:"billNo",width:155}].concat(f)}else{if(d.pageType=="billDetail"&&d.gridHasOrderNo){f=[{text:"序号",dataIndex:"orderNo",width:50}].concat(f)}}if(d.gridHasMark){var h={text:"备注",dataIndex:"remarks"};if(!d.gridReadOnly){h.editor=true}f.push(h)}if(d.gridHasCreator){f=f.concat([{text:"创建人",dataIndex:"creator",width:80},{text:"创建时间",dataIndex:"createTime",width:140}])}if(d.gridHasModifier){f=f.concat([{text:"修改人",dataIndex:"modifier",width:80},{text:"修改时间",dataIndex:"modifyTime",width:140}])}if(d.gridHasAuditor){f=f.concat([{dataIndex:"auditor",text:"审核人",width:80},{dataIndex:"auditTime",text:"审核时间",width:140}])}if(d.gridMSizeIdx>-1){Ext.Array.insert(f,d.gridMSizeIdx,[{text:"物料尺码信息",mSizeCol:true}])}Ext.apply(d.grid,{editModel:d.gridEditModel,isCanAdd:d.gridCanAdd,isCanEdit:d.gridCanEdit,isCanDelete:d.gridCanDelete,isMaster:d.gridIsMaster,isReadOnly:d.gridReadOnly,batchUrl:d.gridSaveUrl,exportUrl:d.gridExportUrl,importUrl:d.gridImportUrl,primaryKey:d.gridPrimaryKey,unionKey:d.gridUnionKey,columns:f,vcolumn:f,modelName:d.gridModel,supGrid:d.gridSupGrid,subGrid:d.gridSubGrid,hasOrderNo:d.gridHasOrderNo,mSizeIdx:d.gridMSizeIdx,mSizeUrl:d.gridMSizeUrl,mSizeQtyField:d.gridMSizeQtyField,mSizeFillFields:d.gridMSizeFillField,sizeInputType:d.gridSizeInputType,convertToSize:d.gridMConvertSize,colNames:d.gridcolNames,mustArray:d.gridmustArray,isValidateAll:d.gridisValidateAll,mainKey:d.gridmainKey,validationConditions:d.gridvalidationConditions,auditUrl:d.gridAuditUrl,isFilter:d.gridFilterStatus,isLocal:d.gridFilterType,fileName:d.gridfileName,fileType:d.gridfileType,exportColumns:d.gridexportColumns,logWinTitle:d.gridLogWinTitle,logLoadUrl:d.gridLogLoadUrl});if(d.gridTitle){d.grid.title=d.gridTitle}else{delete d.grid.title}if(d.gridEditModel==="cell"){d.grid.plugins=[{ptype:"cellediting",clicksToEdit:1}]}else{if(d.gridEditModel==="row"){d.grid.plugins=[{ptype:"rowediting",clicksToEdit:2}]}else{delete d.grid.plugins}}if(d.grid.plugins){d.grid.plugins.push("Hcheaderfilter")}else{d.grid.plugins=["Hcheaderfilter"]}if(d.gridCanDrag){d.grid.viewConfig.plugins=[{ptype:"gridviewdragdrop",ddGroup:"dd_commongrid",enableDrop:true}]}if(d.gridSelModel=="checkboxmodel"){d.grid.selModel.selType="checkboxmodel";d.grid.selModel.mode="MULTI";d.grid.selModel.allowDeselect=true}else{d.grid.selModel.selType="rowmodel",d.grid.selModel.mode=d.gridSelModel;d.grid.selModel.allowDeselect=d.gridCanDeSelect}var b=Hc.clone(d.searchItems);if(d.pageType=="billList"){d.billStatusUrl=d.billStatusUrl||"";if(!d.billStatusUrl&&d.billStatusKey){d.billStatusUrl=Hc.mdmPath+"bas_dict/getbasdictcombo.json?dictCode="+d.billStatusKey}if(Ext.isEmpty(d.billStatusUrl)&&Ext.isEmpty(d.billStatusData)){d.billStatusUrl=Hc.mdmPath+"bas_dict/getbasdictcombo.json?dictCode=bill_status"}var c=new Date();b=[{fieldLabel:d.billStatusText,name:"billStatus",reference:"ddlBillStatus",xtype:"ddlfield",editable:false,valueField:"itemCode",displayField:"itemName",async:true,localData:d.billStatusData,url:d.billStatusUrl},{fieldLabel:d.billNoText,name:"billNo"},{fieldLabel:"创建人",name:"creator"},{fieldLabel:"审核人",name:"auditor"},{fieldLabel:"创建时间",xtype:"datefield",name:"createTime1",allowBlank:false,value:Ext.Date.format(Ext.Date.add(c,"d",-31),"Y-m-d")},{fieldLabel:"至",xtype:"datefield",name:"createTime2",allowBlank:false,value:Ext.Date.format(c,"Y-m-d"),vtype:"compareTo",compareTo:"createTime1",compareType:">=",compareError:"创建时间开始不能大于结束"},{fieldLabel:"审核时间",xtype:"datefield",name:"auditTime1"},{fieldLabel:"至",xtype:"datefield",name:"auditTime2",vtype:"compareTo",compareTo:"auditTime1",compareType:">=",compareError:"审核时间开始不能大于结束"}].concat(b)}d.searchPanel.layout.columns=d.searchColumn;d.searchPanel.defaults.width=d.fieldWidth;d.searchPanel.defaults.labelAlign=d.labelAlign;d.searchPanel.defaults.labelWidth=d.labelWidth;if(b.length>3){d.searchPanel.layout.type="table"}else{if(b.length>0){d.searchPanel.layout.type="column";Ext.each(b,function(e){e.columnWidth=e.columnWidth||"0.25"})}}d.searchPanel.items=b;d.editPanel.layout.type=d.gridEditLayout;d.editPanel.height=d.gridEditHeight==-1?d.controller.getBodyHeight(0.4):d.gridEditHeight;if((d.gridEditColumn>0&&d.gridEditItems.length==0)||d.gridEditModel=="window"){d.editPanel.items=d.controller.getFormItems(d.grid.columns,"gridRow");if(d.gridEditColumn==0){d.gridEditColumn=4}}else{d.editPanel.items=d.gridEditItems}if(d.gridEditLayout=="table"){d.editPanel.layout.columns=d.gridEditColumn;d.editPanel.defaults.width=d.fieldWidth;d.editPanel.defaults.labelAlign=d.labelAlign;d.editPanel.defaults.labelWidth=d.labelWidth}if(!d.customLayout){d.items=[d.toolbar];if(d.searchPanel.items.length>0){d.items.push(d.searchPanel)}d.items.push(d.grid);if(d.editPanel.items.length>0&&d.gridEditModel!="window"){d.items.push(d.editPanel)}d.otherItems=d.otherItems||[];d.items=d.items.concat(d.otherItems)}try{d.callParent()}catch(g){Hc.alert(g)}}});
Ext.define("Hc_Common.view.BaseSimplePageController",{extend:"Hc_Common.view.BasePageController",alias:"controller.basesimplepage",init:function(){var c=this,a=c.getObjList();c.callParent(arguments);try{if(!a){return}var b=a.mastergrid;if(!c.workObject&&b){c.workObject=b}if(b){b.on("beforeselect",c.onGridBeforeSelect,c);b.on("selectionchange",c.onGridSelectionChange,c);b.store.on("beforeload",c.onGridBeforeLoad,c);b.store.on("load",c.onGridLoaded,c);b.on("beforeedit",c.onGridBeforeEdit,c);b.on("edit",c.onGridAfterEdit,c);b.store.on("update",c.onGridDataChanged,c);b.store.on("datachanged",c.onGridDataChanged,c);b.on("rowdblclick",c.onGridRowDblClick,c);if(c.canAdd()&&c.canDelete()&&!b.isReadOnly){b.view.getRowClass=c.initRowClass}}c.initToolbar(a);c.setLabelCls();c.initGridCls(a)}catch(d){}},onBtnSearchClick:function(c){var e=this,b=e.workObject.store,a=e.getObj("commonsearch");console.info("store:");console.info(b);console.info(e);if(a){var d=a.getValues();console.info(d);console.info("store:end");for(var f in d){if(d[f]!==""){b.proxy.extraParams[f]=d[f]}else{delete b.proxy.extraParams[f]}}}if(e.beforeSearch(b)===false){return}b.currentPage=1;b.loadPage(1)},keyToSearch:function(c,b){var a=this;if(b.ctrlKey&&b.keyCode==b.ENTER){a.onBtnSearchClick()}else{if(b.keyCode==b.ESC){a.onBtnResetClick()}}},beforeSearch:function(d){var h=this,b=h.view.searchNotNullField;if(!b){return true}var g=h.getObj("commonsearch"),c=false,f=b.split(","),a,e=[];f.forEach(function(i){a=Hc.getField(g,i);if(a){if(!Ext.isEmpty(a.getValue())){c=true}e.push("【"+a.labelField+"】")}});if(!c){Hc.alert("查询条件"+e.join("")+",必须输入一组值")}return c},onBtnResetClick:function(a){var c=this,b=c.getObj("commonsearch");if(b){b.reset()}},onBtnAddClick:function(b){var g=this,a=g.workObject,k=a.store,f=k.model,c=a.columns,h=-1,j=k.getCount();if(!a.isCanAdd||a.isReadOnly){Hc.alert("此网络不可新增记录");return}var d=f.create({_flag:"A"});if(g.initAddData(d)===false){return}k.add(d);a.getSelectionModel().select(j);if(a.editModel!="cell"&&a.editModel!="row"){return}for(var e=0;e<c.length;e++){if(c[e].getEditor()){h=e;break}}if(h==-1){return}if(a.editModel=="cell"){a.editingPlugin.startEditByPosition({row:j,column:h})}else{a.editingPlugin.startEdit(j,h)}},initAddData:function(a){},onBtnImportClick:function(c){var i=this,d="",a=i.workObject,b=a.supGrid,g="";var h=new Hc_Common.ux.HcImport({workObject:i.workObject});h.show();return;if(!a.isCanAdd||a.isReadOnly){Hc.alert("此网络不可新增记录");return}if(!a.importUrl){Hc.alert("此网格数据不支持批量导入功能");return}if(b&&i.getObj(b).getSelection().length<1){Hc.alert("主表没有选中记录时，从表不能导入");return false}if(a.colNames==""){d+="此网格没有指定导入列：colNames<br>"}if(a.mustArray==""){d+="此网格没有指定列的值是否为必填：mustArray<br>"}if(a.isValidateAll==""){d+="此网格没有指定是否要全部验证通过才导入：isValidateAll<br>"}if(a.validationConditions==""){d+="此网格没有指定公共验证条件：validationConditions<br>"}if(d!=""){Hc.alert(d);return}if(a.isMaster){Hc.alert("当前网格为主表不能批量导入");return}else{if(b){var j=i.getObj(b),k=j.primaryKey,f=j.getSelection()[0].get[k];g='{"'+k+'":'+f+"}"}}var e={xtype:"form",grid:a,isUpload:true,baseCls:"x-plain",bodyPadding:10,items:[{xtype:"filefield",name:"importFileValue",fieldLabel:"请选择文件(.xls,.xlsx)",labelWidth:150,width:280,msgTarget:"side",allowBlank:false,anchor:"100%",buttonText:"选择..."},{xtype:"textfield",name:"colNames",hidden:true,fieldLabel:"指定导入列的名字（多个列用逗号隔开）",labelWidth:150,width:280,value:a.colNames},{xtype:"textfield",name:"mustArray",hidden:true,fieldLabel:"是否必填（对应上面指定列的是否必填，多个用逗号隔开）",labelWidth:150,width:280,value:a.mustArray},{xtype:"textfield",name:"isValidateAll",hidden:true,fieldLabel:"是否要全部验证通过才导入（Y 或N）",labelWidth:150,width:280,value:a.isValidateAll},{xtype:"textfield",name:"mainKey",hidden:true,fieldLabel:"验证有重复(填写属性名，多个用逗号隔开)",labelWidth:150,width:280,value:a.mainKey},{xtype:"textfield",name:"validationConditions",hidden:true,fieldLabel:"公共验证条件(Json字符串数组)",labelWidth:150,width:280,value:a.validationConditions},{xtype:"textfield",name:"objJson",hidden:true,fieldLabel:"从表导入，设值主表主键值",labelWidth:150,width:280,value:g}]};i.showInWin(e,{winName:"importwin",title:"批量导入"})},onWinConfirmClick:function(a){var d=a.up("window");if(d.winName=="importwin"){var c=d.down("form"),b=c.getForm();if(!b.isValid()){return}b.submit({url:c.grid.importUrl,waitMsg:"正在导入...",success:function(f,e){Hc.alert(e.result?e.result.msg:"导入成功！");c.grid.store.reload();d.close()},failure:function(f,e){Ext.Msg.alert("导入提示",e.result.result.msg);c.grid.store.reload();if(e.result.result.msg=="导入成功"){d.close()}}})}},onBtnCopyClick:function(e){var g=this,d=g.workObject,b=g.workObject.store,c=g.workObject.primaryKey,f=g.workObject.getSelection(),a;if(f.length<1){return}if(!d.isCanAdd||d.isReadOnly){Hc.alert("此网格不允许新增数据");return}if(d.isMaster&&this.editingList.length>0){Hc.alert("您有一笔数据正在处理，不能复制主表记录");return}Ext.each(f,function(h){a=Ext.create(b.model);Ext.apply(a.data,h.data);a.set(c,"");a.set("_flag","A");if(g.beforeCopy(a)!==false){b.add(a)}})},beforeCopy:function(a){},onBtnDeleteClick:function(c){var d=this,f=this.workObject,b=f.getStore(),e=false,a=f.getSelection();if(a.length<1){return}if(f.isReadOnly||!f.isCanDelete){return}if(this.checkDelete(a)===false){return}Ext.each(a,function(g){var i=g.get("_flag"),h=g.get("billStatus");if(i=="A"){b.remove(g)}else{if(h==null||h<d.view.auditStatus){g.set("_flag","D");e=true}}});if(e){f.view.refresh()}},checkDelete:function(a){},onBtnUndoClick:function(d){var c=this.workObject,b=c.store,a=c.getSelectionModel().getSelection();Ext.each(a,function(e){if(e.phantom){b.remove(e)}else{e.reject()}})},onBtnCancelClick:function(c){var b=this.workObject,a=b.getStore();a.rejectChanges();b.view.refresh()},onBtnSaveClick:function(a){var b=this,c=b.workObject;if(!c.isUpdating){return}var d=b.getDataToSave(c);if(!d){return}if(b.beforeSave(d)===false){return}b.saveData({srcObj:c,data:d,btn:a})},beforeSave:function(a){},afterSave:function(a,b){var c=this;c.callParent(arguments);if(a.result.resultCode=="0"){if(b.srcObj.is("grid")){b.srcObj.store.reload()}else{c.afterSaveResetForm(a,b)}}else{Hc.alert(a.result.msg)}},afterSaveResetForm:function(a,b){},onBtnExportPageClick:function(b){var g=this,d="",a=g.workObject,e=g.getObjList(),i=a.exportUrl,h="",c=e.commonsearch;var f=new Hc_Common.ux.HcExport({gridColumns:g.workObject.columns,grid:g.workObject,objs:g.getObjList(),exportUrl:a.exportUrl,searchPanel:e.commonsearch,subgridExport:null,exportType:"page"});f.show();return;return false},onBtnExportAllClick:function(b){var g=this,d="",a=g.workObject,e=g.getObjList(),i=a.exportUrl,c=e.commonsearch,h="";var f=new Hc_Common.ux.HcExport({gridColumns:g.workObject.columns,grid:g.workObject,objs:g.getObjList(),exportUrl:a.exportUrl,searchPanel:e.commonsearch,subgridExport:null,exportType:"all"});f.show();return;return false},onBtnPrintClick:function(a){},onBtnViewLog:function(a){},beforeAudit:function(a){},onBtnAuditClick:function(c){var f=this,b=f.workObject;if(b.isUpdating){return}var a=b.getSelection(),h=[],g={},d;a.each(function(i){d=i.get("billStatus");if(d!=null&&d<f.view.auditStatus){i.set("billStatus",f.view.auditStatus);i.set("auditor",f.getUserName());i.set("auditTime",new Date());h.push(i.data)}});var e=h.length;if(e<1){Hc.alert("没有需要审批的记录");return}if(f.beforeAudit(h)===false){return}Hc.confirm("有"+e+"条记录可审批,确认审批",function(i){if(i!="yes"){return}g.updateList=h;var j={url:b.auditUrl,method:"POST",jsonData:JSON.stringify(g),success:function(k,l){var m=JSON.parse(k.responseText);if(m.result.resultCode=="0"){b.store.reload()}else{Hc.alert(m.result.msg)}},failure:function(k){Hc.show({title:"错误提示",msg:k.responseText,height:300,width:500})}};f.callServer(j)})},onBtnBatchModifyClick:function(b){var f=this,a=f.workObject,e=[],d;if(a.isReadOnly||!a.isCanEdit||!f.canEdit()||a.store.getCount()==0){return}Ext.each(a.columns,function(g){if(g.getEditor&&g.getEditor()&&g.dataIndex!=a.primaryKey){var h={code:g.dataIndex,name:g.text};e.push(h)}});d={xtype:"form",bodyPadding:"20 10 10 10",baseCls:"x-plain",items:[{xtype:"combobox",width:280,displayField:"name",valueField:"code",fieldLabel:"更改列",name:"fieldName",allowBlank:false,store:{fields:["code","name"],data:e}},{name:"fieldValue",xtype:"textfield",fieldLabel:"更改值",width:280},{xtype:"radiogroup",columns:2,vertical:false,items:[{boxLabel:"更改选中行",name:"changeType",inputValue:"1",checked:true,width:140},{boxLabel:"更改所有行",name:"changeType",inputValue:"2"}]}]};var c=function(g){var j=g.up("window"),i=j.down("form"),k=i.getValues(),h;if(!i.isValid()){return}if(!k.changeType){return}else{if(k.changeType==1){h=a.getSelection()}else{h=a.store.data.items}}if(h.length<1){Hc.alert("没有需要更改的行");return}Hc.confirm("确认批量更改此列的值？",function(l){if(l=="yes"){Ext.each(h,function(m){if(m.get("billStatus")==null){m.set(k.fieldName,k.fieldValue)}else{if(m.get("billStatus")<f.view.auditStatus){m.set(k.fieldName,k.fieldValue)}}})}})};Ext.widget("window",{title:"批量更改",width:320,height:200,constrain:true,closeAction:"destroy",autoShow:true,items:[d],bbar:["->",{xtype:"button",text:"确认",glyph:Hc.Icon.btnSave,handler:c,scope:f},{xtype:"button",text:"退出",glyph:Hc.Icon.btnCancel,handler:function(g){g.up("window").close()}}]})},onFilterClose:function(b){var c=this,a=c.workObject;if(typeof(a.setFilterStatus)=="function"){a.setFilterStatus(false);c._setBtnFilterText(b.up("[itemId='btnFilter']"))}},onSetFilterLocal:function(b){var c=this,a=c.workObject;a.isLocal=true;if(typeof(a.setFilterStatus)=="function"){a.setFilterStatus(true)}c._setBtnFilterText(b.up("[itemId='btnFilter']"))},onSetFilterServer:function(b){var c=this,a=c.workObject;a.isLocal=false;if(typeof(a.setFilterStatus)=="function"){a.setFilterStatus(true)}c._setBtnFilterText(b.up("[itemId='btnFilter']"))},_setBtnFilterText:function(b){var c=this,a=c.workObject;if(typeof(a.setFilterStatus)!="function"){b.setText("请加入filter插件");return}if(a.getFilterStatus()){text="过滤["+(a.isLocal?"本页":"所有")+"]"}else{text="过滤"}b.setText(text)},onBtnOther2:function(a){},onBtnOther3:function(a){},onBtnOther4:function(a){},onBtnOther5:function(a){},onGridBeforeSelect:function(c,d,a,b){},onGridSelectionChange:function(c,d,a,b){this.gridSelectionChange(c,d)},onGridBeforeEdit:function(a,c){var b=this;if(b.gridCannotEditKeyField(c)===false){return false}if(b.sizeFieldBeforeEdit(b.getObj("mastergrid"),c)===false){return false}},onGridAfterEdit:function(a,c){var b=this;b.checkKeyValue(c);b.setSizeColsOnEdit(b.getObj("mastergrid"),c)},onGridDataChanged:function(a){this.gridDataChanged(a,"mastergrid")},onGridBeforeLoad:function(a,c){var b=this,d=this.getObj("commonsearch");if(d&&!d.isValid()){return false}if(b.gridIsCanLoad(a,"mastergrid")===false){return false}},onGridLoaded:function(g,c,d,i){var f=this,h,b=f._idValue,a=f.getObj("mastergrid"),e=a.primaryKey;f.setSizeColsOnLoad(a,g,i);if(b){h=Ext.Array.findBy(c,function(j){return j.get(e)==b});f._idValue=""}if(h){a.getSelectionModel().select(h)}else{f.bindSubGrid(a)}},onGridRowDblClick:function(b,a,c,f,d){},onGirdActivate:function(a,b){this.workObject=a.grid},initGridCls:function(a){var d=this,c,b="";a=a||d.getObjList();for(c=0;c<10;c++){if(c==0){b="mastergrid"}else{b="grid"+c}if(!a[b]){continue}d.gridHeadCls(a[b])}},initToolbar:function(a){var b=this,d=true;if(a.btnAdd){a.btnAdd.setVisible(b.canAdd())}if(a.btnPrint){a.btnPrint.setVisible(b.canPrint())}if(a.btnExport){a.btnExport.setVisible(b.canExport())}if(a.btnDelete){a.btnDelete.setVisible(b.canDelete())}if(a.commonsearch){var c=a.commonsearch.query("textfield,numberfield,datefield,combo");Ext.each(c,function(e){e.on("specialkey",b.keyToSearch,b);e.on("afterrender",function(){if(e.labelEl){e.labelEl.on("dblclick",function(){e.setValue("")})}})})}if(!a.commonsearch&&a.btnReset){a.btnReset.setVisible(false)}b.initBtnAudit(a);a.btnFilter.setVisible(d);b.workObject.setFilterStatus(false);b._setBtnFilterText(a.btnFilter)},setLabelCls:function(){var a=this.view.query("textfield,numberfield,datefield,combo");Ext.each(a,function(b){if(b.fieldLabel){b.on("afterrender",function(){if(b.labelEl){var c=this.up("form");if(b.allowBlank===false){b.labelEl.addCls("notnull-field")}else{if(c&&c.reference==="commonbill"&&b.canInput!=false){b.labelEl.addCls("cannull-field")}else{if(!c&&b.canInput!=false&&b.readOnly!=true){b.labelEl.addCls("cannull-field")}}}}})}})},initBtnAudit:function(b){var d=this,a=b.btnAudit;if(!a){return}a.setVisible(false);if(!d.canAudit()){return}if(b.matergrid&&b.matergrid.auditUrl){a.setVisible(true);return}for(var c=1;c<10;c++){if(b["grid"+c]&&b["grid"+c].auditUrl){a.setVisible(true);break}}}});
Ext.define("Hc_Common.view.BaseSimplePageModel",{extend:"Hc_Common.view.BasePageModel",alias:"viewmodel.basesimplepage",data:{gridRow:null}});
Ext.define("Hc_Common.view.BaseMultiPage",{extend:"Hc_Common.view.BaseSimplePage",controller:"basemultipage",viewModel:{type:"basemultipage"},customLayout1:false,gridSelModel:"SINGLE",gridCanDeSelect:false,gridIsMaster:true,grid1Columns:[],grid1Model:"",grid1PrimaryKey:"",grid1UnionKey:"",grid1LoadUrl:"",grid1ExportUrl:"",grid1ImportUrl:"",grid1LogWinTitle:"",grid1LogLoadUrl:"",grid1ReadOnly:false,grid1CanAdd:true,grid1CandDelete:true,grid1CanEdit:true,grid1EditModel:"cell",grid1AutoLoad:false,grid1Title:"",grid1Region:"center",grid1SupGrid:"",grid1SubGrid:[],grid1EditColumn:0,grid1EditItems:[],grid1MSizeIdx:-1,grid1SizeInputType:"number",grid1HasMark:true,grid1HasCreator:false,grid1HasModifier:false,grid1HasAuditor:false,grid1:{xtype:"grid",reference:"grid1"},grid2Columns:[],grid2Model:"",grid2PrimaryKey:"",grid2UnionKey:"",grid2LoadUrl:"",grid2ExportUrl:"",grid2ImportUrl:"",grid2LogWinTitle:"",grid2LogLoadUrl:"",grid2ReadOnly:false,grid2CanAdd:true,grid2CandDelete:true,grid2CanEdit:true,grid2EditModel:"cell",grid2Title:"",grid2Region:"center",grid2SupGrid:"",grid2SubGrid:[],grid2EditColumn:0,grid2EditItems:[],grid2MSizeIdx:-1,grid2SizeInputType:"number",grid2HasMark:true,grid2HasCreator:false,grid2HasModifier:false,grid2HasAuditor:false,grid2:{xtype:"grid",reference:"grid2"},grid3Columns:[],grid3Model:"",grid3PrimaryKey:"",grid3UnionKey:"",grid3LoadUrl:"",grid3ExportUrl:"",grid3ImportUrl:"",grid3LogWinTitle:"",grid3LogLoadUrl:"",grid3ReadOnly:false,grid3CanAdd:true,grid3CandDelete:true,grid3CanEdit:true,grid3EditModel:"cell",grid3Title:"",grid3Region:"center",grid3SupGrid:"",grid3SubGrid:[],grid3EditColumn:0,grid3EditItems:[],grid3MSizeIdx:-1,grid3SizeInputType:"number",grid3HasMark:true,grid3HasCreator:false,grid3HasModifier:false,grid3HasAuditor:false,grid3:{xtype:"grid",reference:"grid3"},grid4Columns:[],grid4Model:"",grid4PrimaryKey:"",grid4UnionKey:"",grid4LoadUrl:"",grid4ExportUrl:"",grid4ImportUrl:"",grid4LogWinTitle:"",grid4LogLoadUrl:"",grid4ReadOnly:false,grid4CanAdd:true,grid4CandDelete:true,grid4CanEdit:true,grid4EditModel:"cell",grid4Title:"",grid4Region:"center",grid4SupGrid:"",grid4SubGrid:[],grid4EditColumn:0,grid4EditItems:[],grid4MSizeIdx:-1,grid4SizeInputType:"number",grid4HasMark:true,grid4HasCreator:false,grid4HasModifier:false,grid4HasAuditor:false,grid4:{xtype:"grid",reference:"grid4"},grid5Columns:[],grid5Model:"",grid5PrimaryKey:"",grid5UnionKey:"",grid5LoadUrl:"",grid5ExportUrl:"",grid5ImportUrl:"",grid5LogLoadUrl:"",grid5LogLoadUrl:"",grid5ReadOnly:false,grid5CanAdd:true,grid5CandDelete:true,grid5CanEdit:true,grid5EditModel:"cell",grid5Title:"",grid5Region:"center",grid5SupGrid:"",grid5SubGrid:[],grid5EditColumn:0,grid5EditItems:[],grid5MSizeIdx:-1,grid5SizeInputType:"number",grid5HasMark:true,grid5HasCreator:false,grid5HasModifier:false,grid5HasAuditor:false,grid5:{xtype:"grid",reference:"grid5"},grid6Columns:[],grid6Model:"",grid6PrimaryKey:"",grid6UnionKey:"",grid6LoadUrl:"",grid6ExportUrl:"",grid6ImportUrl:"",grid6LogWinTitle:"",grid6LogLoadUrl:"",grid6ReadOnly:false,grid6CanAdd:true,grid6CandDelete:true,grid6CanEdit:true,grid6EditModel:"cell",grid6Title:"",grid6Region:"center",grid6SupGrid:"",grid6SubGrid:[],grid6EditColumn:0,grid6EditItems:[],grid6MSizeIdx:-1,grid6SizeInputType:"number",grid6HasMark:true,grid6HasCreator:false,grid6HasModifier:false,grid6HasAuditor:false,grid6:{xtype:"grid",reference:"grid6"},grid7Columns:[],grid7Model:"",grid7PrimaryKey:"",grid7UnionKey:"",grid7LoadUrl:"",grid7ExportUrl:"",grid7ImportUrl:"",grid7LogWinTitle:"",grid7LogLoadUrl:"",grid7ReadOnly:false,grid7CanAdd:true,grid7CandDelete:true,grid7CanEdit:true,grid7EditModel:"cell",grid7Title:"",grid7Region:"center",grid7SupGrid:"",grid7SubGrid:[],grid7EditColumn:0,grid7EditItems:[],grid7MSizeIdx:-1,grid7SizeInputType:"number",grid7HasMark:true,grid7HasCreator:false,grid7HasModifier:false,grid7HasAuditor:false,grid7:{xtype:"grid",reference:"grid7"},grid8Columns:[],grid8Model:"",grid8PrimaryKey:"",grid8UnionKey:"",grid8LoadUrl:"",grid8ExportUrl:"",grid8ImportUrl:"",gri8LogWinTitle:"",grid8LogLoadUrl:"",grid8ReadOnly:false,grid8CanAdd:true,grid8CandDelete:true,grid8CanEdit:true,grid8EditModel:"cell",grid8Title:"",grid8Region:"center",grid8SupGrid:"",grid8SubGrid:[],grid8EditColumn:0,grid8EditItems:[],grid8MSizeIdx:-1,grid8SizeInputType:"number",grid8HasMark:true,grid8HasCreator:false,grid8HasModifier:false,grid8HasAuditor:false,grid8:{xtype:"grid",reference:"grid8"},grid9Columns:[],grid9Model:"",grid9PrimaryKey:"",grid9UnionKey:"",grid9LoadUrl:"",grid9ExportUrl:"",grid9ImportUrl:"",grid9LogWinTitle:"",grid9LogLoadUrl:"",grid9ReadOnly:false,grid9CanAdd:true,grid9CandDelete:true,grid9CanEdit:true,grid9EditModel:"cell",grid9Title:"",grid9Region:"center",grid9SupGrid:"",grid9SubGrid:[],grid9EditColumn:0,grid9EditItems:[],grid9MSizeIdx:-1,grid9SizeInputType:"number",grid9HasMark:true,grid9HasCreator:false,grid9HasModifier:false,grid9HasAuditor:false,grid9:{xtype:"grid",reference:"grid9"},grid1colNames:"",grid1mustArray:"",grid1isValidateAll:"",grid1mainKey:"",grid1validationConditions:"",grid1fileName:"",grid1fileType:"",grid1exportColumns:"",grid2colNames:"",grid2mustArray:"",grid2isValidateAll:"",grid2mainKey:"",grid2validationConditions:"",grid2fileName:"",grid2fileType:"",grid2exportColumns:"",grid3colNames:"",grid3mustArray:"",grid3isValidateAll:"",grid3mainKey:"",grid3validationConditions:"",grid3fileName:"",grid3fileType:"",grid3exportColumns:"",grid4colNames:"",grid4mustArray:"",grid4isValidateAll:"",grid4mainKey:"",grid4validationConditions:"",grid4fileName:"",grid4fileType:"",grid4exportColumns:"",grid5colNames:"",grid5mustArray:"",grid5isValidateAll:"",grid5mainKey:"",grid5validationConditions:"",grid5fileName:"",grid5fileType:"",grid5exportColumns:"",grid6colNames:"",grid6mustArray:"",grid6isValidateAll:"",grid6mainKey:"",grid6validationConditions:"",grid6fileName:"",grid6fileType:"",grid6exportColumns:"",grid7colNames:"",grid7mustArray:"",grid7isValidateAll:"",grid7mainKey:"",grid7validationConditions:"",grid7fileName:"",grid7fileType:"",grid7exportColumns:"",grid8colNames:"",grid8mustArray:"",grid8isValidateAll:"",grid8mainKey:"",grid8validationConditions:"",grid8fileName:"",grid8fileType:"",grid8exportColumns:"",grid9colNames:"",grid9mustArray:"",grid9isValidateAll:"",grid9mainKey:"",grid9validationConditions:"",grid9fileName:"",grid9fileType:"",grid9exportColumns:"",grid1MConvertSize:0,grid2MConvertSize:0,grid3MConvertSize:0,grid4MConvertSize:0,grid5MConvertSize:0,grid6MConvertSize:0,grid7MConvertSize:0,grid8MConvertSize:0,grid9MConvertSize:0,grid1HasOrderNo:true,grid2HasOrderNo:true,grid3HasOrderNo:true,grid4HasOrderNo:true,grid5HasOrderNo:true,grid6HasOrderNo:true,grid7HasOrderNo:true,grid8HasOrderNo:true,grid9HasOrderNo:true,grid1MSizeUrl:Hc.sdsPath+"bl_co_dtl/listvo.json?selectVoName=SelectListByVoBlCoMaterial",grid1MSizeQtyField:"sizeQty",grid1MSizeFillField:"materialName,sizeTypeNo",grid2MSizeUrl:Hc.sdsPath+"bl_co_dtl/listvo.json?selectVoName=SelectListByVoBlCoMaterial",grid2MSizeQtyField:"sizeQty",grid2MSizeFillField:"materialName,sizeTypeNo",grid3MSizeUrl:Hc.sdsPath+"bl_co_dtl/listvo.json?selectVoName=SelectListByVoBlCoMaterial",grid3MSizeQtyField:"sizeQty",grid3MSizeFillField:"materialName,sizeTypeNo",grid4MSizeUrl:Hc.sdsPath+"bl_co_dtl/listvo.json?selectVoName=SelectListByVoBlCoMaterial",grid4MSizeQtyField:"sizeQty",grid4MSizeFillField:"materialName,sizeTypeNo",grid5MSizeUrl:Hc.sdsPath+"bl_co_dtl/listvo.json?selectVoName=SelectListByVoBlCoMaterial",grid5MSizeQtyField:"sizeQty",grid5MSizeFillField:"materialName,sizeTypeNo",grid6MSizeUrl:Hc.sdsPath+"bl_co_dtl/listvo.json?selectVoName=SelectListByVoBlCoMaterial",grid6MSizeQtyField:"sizeQty",grid6MSizeFillField:"materialName,sizeTypeNo",grid7MSizeUrl:Hc.sdsPath+"bl_co_dtl/listvo.json?selectVoName=SelectListByVoBlCoMaterial",grid7MSizeQtyField:"sizeQty",grid7MSizeFillField:"materialName,sizeTypeNo",grid8MSizeUrl:Hc.sdsPath+"bl_co_dtl/listvo.json?selectVoName=SelectListByVoBlCoMaterial",grid8MSizeQtyField:"sizeQty",grid8MSizeFillField:"materialName,sizeTypeNo",grid9MSizeUrl:Hc.sdsPath+"bl_co_dtl/listvo.json?selectVoName=SelectListByVoBlCoMaterial",grid9MSizeQtyField:"sizeQty",grid9MSizeFillField:"materialName,sizeTypeNo",initComponent:function(){var f=this,e={ptype:"cellediting",clicksToEdit:1},d={ptype:"rowediting",clicksToEdit:2},c=[];f.customLayout=true;for(var b=1;b<10;b++){if(f["grid"+b+"Model"]){if(f["grid"+b+"ReadOnly"]){f["grid"+b+"CanAdd"]=false;f["grid"+b+"CanDelete"]=false;f["grid"+b+"CanEdit"]=false}else{if(!f["grid"+b+"CanAdd"]&&!f["grid"+b+"CanDelete"]&&!f["grid"+b+"CanEdit"]){f["grid"+b+"ReadOnly"]=true}}if(f["grid"+b+"EditModel"]=="cell"){f["grid"+b].plugins=e}else{if(f["grid"+b+"EditModel"]=="row"){f["grid"+b].plugins=d}else{delete f["grid"+b].plugins}}var g=Hc.clone(f["grid"+b+"Columns"]);if(f.pageType=="billDetail"&&f["grid"+b+"HasOrderNo"]){g=[{text:"序号",dataIndex:"orderNo"}].concat(g)}if(f["grid"+b+"HasMark"]){var h={text:"备注",dataIndex:"remarks"};if(!f["grid"+b+"ReadOnly"]){h.editor=true}g.push(h)}if(f["grid"+b+"HasCreator"]){g=g.concat([{text:"创建人",dataIndex:"creator",width:80},{text:"创建时间",dataIndex:"createTime",width:140}])}if(f["grid"+b+"HasModifier"]){g=g.concat([{text:"修改人",dataIndex:"modifier",width:80},{text:"修改时间",dataIndex:"modifyTime",width:140}])}if(f["grid"+b+"HasAuditor"]){g=g.concat([{dataIndex:"auditor",text:"审核人",width:80},{dataIndex:"auditTime",text:"审核时间",width:140}])}if(f["grid"+b+"MSizeIdx"]>-1){Ext.Array.insert(g,f["grid"+b+"MSizeIdx"],[{text:"物料尺码信息",mSizeCol:true}])}var a=Ext.create("Hc_Common.store.Base",{autoLoad:false,pageSize:f.pageSize,model:f["grid"+b+"Model"],proxy:{url:f["grid"+b+"LoadUrl"]}});Ext.apply(f["grid"+b],{columnLines:true,columns:g,vcolumn:g,layout:"fit",store:a,selModel:{mode:"MULTI",allowDeselect:true},bbar:{xtype:"pagingtoolbar",plugins:Ext.create("Ext.ux.ComboPageSize",{defaultSize:f.pageSize}),displayInfo:true,store:a},viewConfig:{enableTextSelection:true},region:f["grid"+b+"Region"],modelName:f["grid"+b+"Model"],editModel:f["grid"+b+"EditModel"],isCanAdd:f["grid"+b+"CanAdd"],isCanEdit:f["grid"+b+"CanEdit"],isCanDelete:f["grid"+b+"CandDelete"],isReadOnly:f["grid"+b+"ReadOnly"],exportUrl:f["grid"+b+"ExportUrl"],importUrl:f["grid"+b+"ImportUrl"],primaryKey:f["grid"+b+"PrimaryKey"],unionKey:f["grid"+b+"UnionKey"],supGrid:f["grid"+b+"SupGrid"],subGrid:f["grid"+b+"SubGrid"],hasOrderNo:f["grid"+b+"HasOrderNo"],mSizeIdx:f["grid"+b+"MSizeIdx"],mSizeUrl:f["grid"+b+"MSizeUrl"],mSizeQtyField:f["grid"+b+"MSizeQtyField"],mSizeFillFields:f["grid"+b+"MSizeFillField"],sizeInputType:f["grid"+b+"SizeInputType"],convertToSize:f["grid"+b+"MConvertSize"],colNames:f["grid"+b+"colNames"],mustArray:f["grid"+b+"mustArray"],isValidateAll:f["grid"+b+"isValidateAll"],mainKey:f["grid"+b+"mainKey"],validationConditions:f["grid"+b+"validationConditions"],fileName:f["grid"+b+"fileName"],fileType:f["grid"+b+"fileType"],exportColumns:f["grid"+b+"exportColumns"],logWinTitle:f["grid"+b+"LogWinTitle"],logLoadUrl:f["grid"+b+"LogLoadUrl"]});if(f["grid"+b+"Title"]){f["grid"+b].title=f["grid"+b+"Title"]}else{delete f["grid"+b].title}c.push(f["grid"+b])}}f.bottomPanel={xtype:"tabpanel",region:"south",reference:"commonbottompanel",height:f.controller.getBodyHeight(0.5),split:true,autoDestroy:true,tabPosition:"top",border:false};if(!f.customLayout1){f.items=[f.toolbar];if(f.searchItems.length>0){f.items.push(f.searchPanel)}f.items.push(f.grid);f.bottomPanel.items=c;if(c.length==1){f.bottomPanel.xtype="container";f.bottomPanel.layout="border";delete c[0].title}f.items.push(f.bottomPanel);f.otherItems=f.otherItems||[];f.items=f.items.concat(f.otherItems)}f.callParent(arguments)}});
Ext.define("Hc_Common.view.BaseMultiPageController",{extend:"Hc_Common.view.BaseSimplePageController",alias:"controller.basemultipage",init:function(){var c=this,f=this.canAdd()||this.canEdit()||this.canDelete(),a=c.getReferences();c.callParent(arguments);try{if(!a){return}a.mastergrid.on("containerclick",c.onGirdActivate,c);a.mastergrid.on("cellclick",c.onGirdActivate,c);a.mastergrid.on("headerclick",c.onGirdActivate,c);for(var b=1;b<10;b++){if(a["grid"+b]){a["grid"+b].on("beforeselect",c["onGrid"+b+"BeforeSelect"],c);a["grid"+b].on("selectionchange",c["onGrid"+b+"SelectionChange"],c);a["grid"+b].on("containerclick",c.onGirdActivate,c);a["grid"+b].on("cellclick",c.onGirdActivate,c);a["grid"+b].on("headerclick",c.onGirdActivate,c);a["grid"+b].on("beforeedit",c["onGrid"+b+"BeforeEdit"],c);a["grid"+b].on("edit",c["onGrid"+b+"AfterEdit"],c);a["grid"+b].store.on("update",c["onGrid"+b+"DataChanged"],c);a["grid"+b].store.on("datachanged",c["onGrid"+b+"DataChanged"],c);a["grid"+b].store.on("beforeload",c["onGrid"+b+"BeforeLoad"],c);a["grid"+b].store.on("load",c["onGrid"+b+"Loaded"],c);a["grid"+b].on("dblclick",c["onGrid"+b+"RowDblClick"],c);if(!a["grid"+b].isReadOnly&&f){a["grid"+b].view.getRowClass=this.initRowClass}}}}catch(d){}},initAddData:function(a){var e=this,c=e.getObjList(),f=e.workObject;if(f.isMaster&&e.editingList.length>0){Hc.alert("有一笔数据正在编辑，不能新增主表记录");return false}if(f.supGrid){var d=c[f.supGrid].getSelection()[0];if(!d){Hc.alert("主表没有选中记录时，从表不能新增记录");return false}if(!d.phantom){var b=c[f.supGrid].primaryKey;a.set(b,d.get(b))}}},onBtnSearchClick:function(d){var f=this,h=f.getObjList(),c=h.mastergrid,b=c.store,a=h.commonsearch;if(a){var e=a.getValues();for(var g in e){if(e[g]!==""){b.proxy.extraParams[g]=e[g]}else{delete b.proxy.extraParams[g]}}}if(f.beforeSearch(b)===false){return}b.currentPage=1;b.loadPage(1)},onBtnSaveClick:function(b){var c=this,d={},a=c.getObj("mastergrid");if(c.editingList.length<1){return}d=c.getDataToSave(a);if(!d){return}if(c.beforeSave(d)===false){return}c.saveData({srcObj:a,data:d,btn:b})},onGridBeforeSelect:function(c,f,a,b){var d=this;if(c.view.grid.isMaster&&d.editingList.length>0&&!(f.phantom||f.dirty)){return false}if(d.callParent(arguments)===false){return false}},onGridBeforeEdit:function(a,c){var b=this;if(b.callParent(arguments)===false){return false}if(c.grid.isMaster&&this.editingList.length>0&&!c.grid.getSelectionModel().isSelected(c.rowIdx)){return false}},onGrid1BeforeSelect:function(b,c,a){},onGrid1SelectionChange:function(b,d,a){var c=this;c.gridSelectionChange(b,d)},onGrid1BeforeEdit:function(a,c){var b=this;if(b.gridCannotEditKeyField(c)===false){return false}if(b.sizeFieldBeforeEdit(b.getObj("grid1"),c)===false){return false}},onGrid1AfterEdit:function(a,c){var b=this;b.checkKeyValue(c);b.setSizeColsOnEdit(b.getObj("grid1"),c)},onGrid1DataChanged:function(b,a){var c=this;c.gridDataChanged(b,"grid1")},onGrid1BeforeLoad:function(a,b){if(this.gridIsCanLoad(a,"grid1")===false){return false}},onGrid1Loaded:function(c,b,a,d){var e=this,f=e.getObj("grid1");e.bindSubGrid(f);e.setSizeColsOnLoad(f,c,d)},onGrid1RowDblClick:function(b,a,c,f,d){},onGrid2BeforeSelect:function(b,c,a){},onGrid2SelectionChange:function(b,c,a){this.gridSelectionChange(b,c)},onGrid2BeforeEdit:function(a,c){var b=this;if(b.gridCannotEditKeyField(c)===false){return false}if(b.sizeFieldBeforeEdit(b.getObj("grid2"),c)===false){return false}},onGrid2AfterEdit:function(a,c){var b=this;b.checkKeyValue(c);b.setSizeColsOnEdit(b.getObj("grid2"),c)},onGrid2DataChanged:function(b,a){this.gridDataChanged(b,"grid2")},onGrid2BeforeLoad:function(a,b){if(this.gridIsCanLoad(a,"grid2")===false){return false}},onGrid2Loaded:function(c,b,a,d){var e=this,f=e.getObj("grid2");e.bindSubGrid(f);e.setSizeColsOnLoad(f,c,d)},onGrid2RowDblClick:function(b,a,c,f,d){},onGrid3BeforeSelect:function(b,c,a){},onGrid3SelectionChange:function(b,c,a){this.gridSelectionChange(b,c)},onGrid3BeforeEdit:function(a,c){var b=this;if(b.gridCannotEditKeyField(c)===false){return false}if(b.sizeFieldBeforeEdit(b.getObj("grid3"),c)===false){return false}},onGrid3AfterEdit:function(a,c){var b=this;b.checkKeyValue(c);b.setSizeColsOnEdit(b.getObj("grid3"),c)},onGrid3DataChanged:function(b,a){this.gridDataChanged(b,"grid3")},onGrid3BeforeLoad:function(a,b){if(this.gridIsCanLoad(a,"grid3")===false){return false}},onGrid3Loaded:function(c,b,a,d){var e=this,f=e.getObj("grid3");e.bindSubGrid(f);e.setSizeColsOnLoad(f,c,d)},onGrid3RowDblClick:function(b,a,c,f,d){},onGrid4BeforeSelect:function(b,c,a){},onGrid4SelectionChange:function(b,c,a){this.gridSelectionChange(b,c)},onGrid4BeforeEdit:function(a,c){var b=this;if(b.gridCannotEditKeyField(c)===false){return false}if(b.sizeFieldBeforeEdit(b.getObj("grid4"),c)===false){return false}},onGrid4AfterEdit:function(a,c){var b=this;b.checkKeyValue(c);b.setSizeColsOnEdit(b.getObj("grid4"),c)},onGrid4DataChanged:function(b,a){this.gridDataChanged(b,"grid4")},onGrid4BeforeLoad:function(a,b){if(this.gridIsCanLoad(a,"grid4")===false){return false}},onGrid4Loaded:function(c,b,a,d){var e=this,f=e.getObj("grid4");e.bindSubGrid(f);e.setSizeColsOnLoad(f,c,d)},onGrid4RowDblClick:function(b,a,c,f,d){},onGrid5BeforeSelect:function(b,c,a){},onGrid5SelectionChange:function(b,c,a){this.gridSelectionChange(b,c)},onGrid5BeforeEdit:function(a,c){var b=this;if(b.gridCannotEditKeyField(c)===false){return false}if(b.sizeFieldBeforeEdit(b.getObj("grid5"),c)===false){return false}},onGrid5AfterEdit:function(a,c){var b=this;b.checkKeyValue(c);b.setSizeColsOnEdit(b.getObj("grid5"),c)},onGrid5DataChanged:function(b,a){var c=this;c.gridDataChanged(b,c.getObj("grid5"))},onGrid5BeforeLoad:function(a,b){if(this.gridIsCanLoad(a,"grid5")===false){return false}},onGrid5Loaded:function(c,b,a,d){var e=this,f=e.getObj("grid5");e.bindSubGrid(f);e.setSizeColsOnLoad(f,c,d)},onGrid5RowDblClick:function(b,a,c,f,d){},onGrid6BeforeSelect:function(b,c,a){},onGrid6SelectionChange:function(b,c,a){this.gridSelectionChange(b,c)},onGrid6BeforeEdit:function(a,c){var b=this;if(b.gridCannotEditKeyField(c)===false){return false}if(b.sizeFieldBeforeEdit(b.getObj("grid6"),c)===false){return false}},onGrid6AfterEdit:function(a,c){var b=this;b.checkKeyValue(c);b.setSizeColsOnEdit(b.getObj("grid6"),c)},onGrid6DataChanged:function(b,a){var c=this;c.gridDataChanged(b,c.getObj("grid6"))},onGrid6BeforeLoad:function(a,b){if(this.gridIsCanLoad(a,"grid6")===false){return false}},onGrid6Loaded:function(c,b,a,d){var e=this,f=e.getObj("grid6");e.bindSubGrid(f);e.setSizeColsOnLoad(f,c,d)},onGrid6RowDblClick:function(b,a,c,f,d){},onGrid7BeforeSelect:function(b,c,a){},onGrid7SelectionChange:function(b,c,a){this.gridSelectionChange(b,c)},onGrid7BeforeEdit:function(a,c){var b=this;if(b.gridCannotEditKeyField(c)===false){return false}if(b.sizeFieldBeforeEdit(b.getObj("grid7"),c)===false){return false}},onGrid7AfterEdit:function(a,c){var b=this;b.checkKeyValue(c);b.setSizeColsOnEdit(b.getObj("grid7"),c)},onGrid7DataChanged:function(b,a){var c=this;c.gridDataChanged(b,c.getObj("grid7"))},onGrid7BeforeLoad:function(a,b){if(this.gridIsCanLoad(a,"grid7")===false){return false}},onGrid7Loaded:function(c,b,a,d){var e=this,f=e.getObj("grid7");e.bindSubGrid(f);e.setSizeColsOnLoad(f,c,d)},onGrid7RowDblClick:function(b,a,c,f,d){},onGrid8BeforeSelect:function(b,c,a){},onGrid8SelectionChange:function(b,c,a){this.gridSelectionChange(b,c)},onGrid8BeforeEdit:function(a,c){var b=this;if(b.gridCannotEditKeyField(c)===false){return false}if(b.sizeFieldBeforeEdit(b.getObj("grid8"),c)===false){return false}},onGrid8AfterEdit:function(a,c){var b=this;b.checkKeyValue(c);b.setSizeColsOnEdit(b.getObj("grid8"),c)},onGrid8DataChanged:function(b,a){this.gridDataChanged(b,"grid8")},onGrid8BeforeLoad:function(a,b){if(this.gridIsCanLoad(a,"grid8")===false){return false}},onGrid8Loaded:function(c,b,a,d){var e=this,f=e.getObj("grid8");e.bindSubGrid(f);e.setSizeColsOnLoad(f,c,d)},onGrid8RowDblClick:function(b,a,c,f,d){},onGrid9BeforeSelect:function(b,c,a){},onGrid9SelectionChange:function(b,c,a){this.gridSelectionChange(b,c)},onGrid9BeforeEdit:function(a,c){var b=this;if(b.gridCannotEditKeyField(c)===false){return false}if(b.sizeFieldBeforeEdit(b.getObj("grid9"),c)===false){return false}},onGrid9AfterEdit:function(a,c){var b=this;b.checkKeyValue(c);b.setSizeColsOnEdit(b.getObj("grid9"),c)},onGrid9DataChanged:function(b,a){this.gridDataChanged(b,"grid9")},onGrid9BeforeLoad:function(a,b){if(this.gridIsCanLoad(a,"grid9")===false){return false}},onGrid9Loaded:function(c,b,a,d){var e=this,f=e.getObj("grid9");e.bindSubGrid(f);e.setSizeColsOnLoad(f,c,d)},onGrid9RowDblClick:function(b,a,c,f,d){}});
Ext.define("Hc_Common.view.BaseMultiPageModel",{extend:"Hc_Common.view.BaseSimplePageModel",alias:"viewmodel.basemultipage",data:{grid1Row:null,grid2Row:null,grid3Row:null,grid4Row:null,grid5Row:null,grid6Row:null,grid7Row:null,grid8Row:null,grid9Row:null}});
Ext.define("Hc_Common.view.BaseTreePage",{extend:"Hc_Common.view.BasePage",controller:"basetreepage",viewModel:{type:"basetreepage"},layout:"border",toolbar:{xtype:"toolbar",itemId:"commontoolbar",reference:"commontoolbar",region:"north",items:[{text:"查询",itemId:"btnSearch",handler:"onBtnSearchClick",glyph:Hc.Icon.btnSearch},{text:"重置",itemId:"btnReset",handler:"onBtnResetClick",glyph:Hc.Icon.btnReset},"-",{xtype:"splitbutton",text:"新增",itemId:"btnAdd",reference:"btnAdd",handler:"onBtnAddClick",glyph:Hc.Icon.btnAdd,menu:[{text:"新增下级",itemId:"btnAddChild",reference:"btnAddChild",handler:"onAddChildClick"}]},{text:"更改",itemId:"btnEdit",reference:"btnEdit",handler:"onBtnEditClick",glyph:Hc.Icon.btnEdit,disabled:true},{text:"删除",itemId:"btnDelete",reference:"btnDelete",handler:"onBtnDeleteClick",glyph:Hc.Icon.btnDelete,disabled:true},"-",{text:"上移",itemId:"btnMoveUp",reference:"btnMoveUp",handler:"onBtnMoveUpClick",glyph:Hc.Icon.btnMoveUp,disabled:true},{text:"下移",itemId:"btnMoveDown",reference:"btnMoveDown",handler:"onBtnMoveDownClick",glyph:Hc.Icon.btnMoveDown,disabled:true},"-",{text:"导出",itemId:"btnExport",reference:"btnExport",handler:"onBtnExportPageClick",glyph:Hc.Icon.btnExport},"-",{text:"打印",itemId:"btnPrint",reference:"btnPrint",handler:"onBtnPrintClick",glyph:Hc.Icon.btnPrint,disabled:true},"-",{text:"更多",itemId:"btnOther",reference:"btnOther",xtype:"splitbutton",glyph:Hc.Icon.btnOther,menu:[{text:"查看日志",itemId:"btnViewLog",reference:"btnViewLog",handler:"onBtnViewLogClick"}]}]},searchPanel:{xtype:"form",region:"north",itemId:"commonsearch",reference:"commonsearch",collapsible:true,collapseMode:"undefined",title:"查询面板",layout:"hbox",header:{height:20,padding:0},defaults:{labelAlign:"right",labelWidth:80,width:200},bodyPadding:3,items:[]},tree:{xtype:"treepanel",itemId:"commontree",reference:"commontree",rootVisible:false,lines:true,columns:[{text:"序"}],region:"center",layout:"fit",bind:{store:"{commonstore}"},listeners:{selectionchange:"onTreeSelectionChange"},batchUrl:""},workObject:null,otherItems:[],detailItem:[],initComponent:function(){var a=this;if(a.detailItem.length>0){a.detailWin=Ext.create("Ext.window.Window",{autoShow:false,closeAction:"hide",modal:true,items:[{xtype:"form",items:this.detailItem,layout:{type:"table",columns:2},bodyPadding:10}],title:"新增",bbar:["->",{xtype:"button",text:"确认",handler:function(b){a.controller.onBtnSaveClick(b,a)}},{xtype:"button",text:"取消",handler:function(b){b.up("window").close()}}]})}a.items=[a.toolbar];if(a.searchPanel.items.length>0){a.items.push(a.searchPanel)}a.items.push(a.tree);a.items=a.items.concat(a.otherItems);a.callParent();if(!a.workObject){a.workObject=a.getComponent("commontree")}}});
Ext.define("Hc_Common.view.BaseTreePageController",{extend:"Hc_Common.view.BasePageController",alias:"controller.basetreepage",init:function(){var a=this.getReferences();if(!a){return}if(a.btnAdd){a.btnAdd.setDisabled(!this.canAdd())}if(a.btnExport){a.btnExport.setDisabled(!this.canExport())}},onBtnSearchClick:function(c){var e=this.getView(),b=e.workObject.getStore(),a=e.getComponent("commonsearch");if(a){var d=a.getValues();for(var f in d){if(d[f]!==""){b.proxy.extraParams[f]=d[f]}else{delete b.proxy.extraParams[f]}}}b.reload();e.workObject.view.refresh()},onBtnResetClick:function(){var b=this,a=b.lookupComponent("commonsearch");if(a){a.reset()}},onBtnAddClick:function(){var d=this,f=d.view.detailWin,a=d.view.workObject,c=a.store,b=Ext.create(c.model),e=a.selection;if(e){b.set(c.parentIdProperty,e.id)}d.initAddData(b,e,a,c);f.show();f.down("form").loadRecord(b)},onAddChildClick:function(a){},onBtnDeleteClick:function(c){var e=this,f=e.getView().workObject,b=f.getSelectionModel().getSelection(),d=[],a,g={};if(b.length<1){return}if(e.checkDelete(b)===false){return}Ext.Msg.confirm("系统提示","真的要删除选择的行吗？",function(h){if(h=="yes"){Ext.Array.each(b,function(i){a=new Object();a[i.idProperty]=i.id;d.push(a)});g.deleteList=d;e.saveData(g,f,c)}})},onBtnEditClick:function(a){var c=this,d=c.getView().detailWin,b=c.view.workObject.selection;if(!b){return}d.show();d.down("form").loadRecord(b)},onBtnMoveUpClick:function(a){},onBtnMoveDownClick:function(a){},onBtnSaveClick:function(c){var e=this,a=e.view.workObject,d=c.up("window").down("form"),b=d.getRecord(),f=d.getValues(),g={};if(b.phantom){g.insertList=[f]}else{g.updateList=[f]}e.saveData(g,a,c)},saveData:function(d,a,c){var b=this.getView().tree.batchUrl;if(!b){return}if(c){c.setDisabled(true)}Ext.Ajax.request({url:b,jsonData:JSON.stringify(d),method:"POST",success:function(f){var e=JSON.parse(f.responseText);if(e.result.resultCode=="0"){a.store.reload();a.view.refresh()}else{Ext.MessageBox.alert("提示",e.result.msg)}c.setDisabled(false)},failure:function(e,f){Ext.MessageBox.show({title:"错误提示",msg:e.responseText,height:300,width:400});c.setDisabled(false)}})},onBtnExportPageClick:function(a){alert("【"+a.text+"】处理中...")},onBtnExportAllClick:function(a){},onBtnPrintClick:function(a){},onBtnViewLog:function(a){},onTreeSelectionChange:function(g,c){var e=this,d=this.getReferences(),f=e.lookupReference("btnDelete"),b=e.lookupReference("btnPrint"),a=e.lookupReference("btnEdit");if(this.canDelete()&&f){f.setDisabled(c.length===0)}if(this.canPrint()&&b){b.setDisabled(c.length===0)}if(this.canEdit()){a.setDisabled(c.length===0)}},renderYesNo:function(g,b,e,f,d,c,a){return g?"是":"否"},renderUseFlag:function(g,b,e,f,d,c,a){return g?"启用":"禁用"},customFilter:function(a,b){return true},initAddData:function(c,d,a,b){},checkDelete:function(a){}});
Ext.define("Hc_Common.view.BaseTreePageModel",{extend:"Hc_Common.view.BasePageModel",alias:"viewmodel.basetreepage",data:{theRow:null},stores:{commonstore:{type:"treebase"}}});
Ext.define("Hc_Common.view.BaseBillDetailPage",{extend:"Hc_Common.view.BaseMultiPage",controller:"basebilldetailpage",viewModel:{type:"basebilldetailpage"},listName:"",listStore:"",ddlBillStatus:null,billNo:"",billType:"",billItems:[],billLayout:"table",billColumn:4,billModel:"",billSaveUrl:"",billLoadUrl:"",billExportUrl:"",billAuditUrl:"",billSubGrid:["mastergrid"],hasStatus2:false,gridHasMark:false,gridHasCreator:false,gridHasModifier:false,gridHasAuditor:false,grid1HasMark:false,grid1HasCreator:false,grid1HasModifier:false,grid1HasAuditor:false,grid2HasMark:false,grid2HasCreator:false,grid2HasModifier:false,grid2HasAuditor:false,grid3HasMark:false,grid3HasCreator:false,grid3HasModifier:false,grid3HasAuditor:false,grid4HasMark:false,grid4HasCreator:false,grid4HasModifier:false,grid4HasAuditor:false,grid5HasMark:false,grid5HasCreator:false,grid5HasModifier:false,grid5HasAuditor:false,grid6HasMark:false,grid6HasCreator:false,grid6HasModifier:false,grid6HasAuditor:false,grid7HasMark:false,grid7HasCreator:false,grid7HasModifier:false,grid7HasAuditor:false,grid8HasMark:false,grid8HasCreator:false,grid8HasModifier:false,grid8HasAuditor:false,grid9HasMark:false,grid9HasCreator:false,grid9HasModifier:false,grid9HasAuditor:false,customLayout2:false,billPanel:{xtype:"form",region:"north",maxHeight:400,autoScroll:true,reference:"commonbill",defaults:{},bodyPadding:3,primaryKey:"billNo"},billtoolbar:{xtype:"toolbar",reference:"billtoolbar",region:"north",items:[{text:"上单",itemId:"btnBillPrev",reference:"btnBillPrev",handler:"onBtnBillPrevClick",glyph:Hc.Icon.btnPrev,canUse:false,disabled:true},{text:"下单",itemId:"btnBillNext",reference:"btnBillNext",handler:"onBtnBillNextClick",glyph:Hc.Icon.btnNext,canUse:false,disabled:true},"-",{text:"新单",itemId:"btnBillNew",reference:"btnBillNew",handler:"onBtnBillNewClick",glyph:Hc.Icon.btnAdd},{text:"删单",itemId:"btnBillDel",reference:"btnBillDel",handler:"onBtnBillDelClick",glyph:Hc.Icon.btnDelete},{text:"保存",itemId:"btnBillSave",reference:"btnBillSave",handler:"onBtnSaveClick",glyph:Hc.Icon.btnSave},"-",{text:"导出",itemId:"btnBillExport",reference:"btnBillExport",handler:"onBtnExportAllClick",glyph:Hc.Icon.btnExport},{text:"打印",itemId:"btnBillPrint",reference:"btnBillPrint",handler:"onBtnPrintClick",glyph:Hc.Icon.btnPrint},"-",{text:"审核",itemId:"btnBillAudit",reference:"btnBillAudit",handler:"onBtnBillAuditClick",glyph:Hc.Icon.btnAudit},{text:"功能1",itemId:"btnBillOther1",reference:"btnBillOther1",handler:"btnBillOther1Click",hidden:true},{text:"功能2",itemId:"btnBillOther2",reference:"btnBillOther2",handler:"btnBillOther2Click",hidden:true},{text:"功能3",itemId:"btnBillOther3",reference:"btnBillOther3",handler:"btnBillOther3Click",hidden:true},{text:"功能4",itemId:"btnBillOther4",reference:"btnBillOther4",handler:"btnBillOther4Click",hidden:true},{text:"功能5",itemId:"btnBillOther5",reference:"btnBillOther5",handler:"btnBillOther5Click",hidden:true},"-",{text:"返回",itemId:"btnBillBack",reference:"btnBillBack",handler:"onBtnBillBackClick",glyph:Hc.Icon.btnUndo}]},statusPanel:{xtype:"form",reference:"billstatus",region:"south",layout:{type:"table"},height:22,minheight:20,baseCls:"x-plain",defaults:{width:"100%",labelWidth:60,labelAlign:"right"},defaultType:"displayfield"},pageType:"billDetail",initComponent:function(){var d=this,c=[{xtype:"textfield",name:"billNo",fieldLabel:d.billNoText,bind:{value:"{billRow.billNo}"},canInput:false}].concat(d.billItems);d.customLayout1=true;d.gridSelModel="MULTI";d.gridCanDeSelect=true;d.gridIsMaster=false;Ext.apply(d.billPanel,{store:Ext.create("Hc_Common.store.Base",{type:"basestore",model:d.billModel,proxy:{url:d.billLoadUrl,extraParams:{billNo:d.billNo}}}),items:c,layout:{type:d.billLayout},modelName:d.billModel,loadUrl:d.billLoadUrl,batchUrl:d.billSaveUrl,auditUrl:d.billAuditUrl,subGrid:d.billSubGrid||[]});if(d.billLayout=="table"){d.billPanel.layout.columns=d.billColumn;d.billPanel.defaults.width=d.fieldWidth;d.billPanel.defaults.labelWidth=d.labelWidth;d.billPanel.defaults.labelAlign=d.labelAlign}d.statusPanel.items=[{name:"creator",bind:{value:"{billRow.creator}"},fieldLabel:"创建人"},{name:"createTime",bind:{value:"{billRow.createTime}"},fieldLabel:"创建时间",minWidth:190},{name:"auditor",bind:{value:"{billRow.auditor}"},fieldLabel:"审核人"},{name:"auditTime",bind:{value:"{billRow.auditTime}"},fieldLabel:"审核时间",minWidth:190},{name:"billStatus",bind:{value:"{billStatusText}"},fieldLabel:"状态"}];d.statusPanel.layout.columns=5;if(d.hasStatus2){d.statusPanel.items.push({name:"billStatusMax",fieldLabel:"最高状态",bind:{value:"{billStatus2Text}"}});d.statusPanel.layout.columns=6}if(!d.customLayout2){d.items=[d.billtoolbar];d.items.push(d.billPanel);d.items.push(d.toolbar);if(d.grid1Model){var a={xtype:"tabpanel",region:"center",split:true,autoDestroy:true,tabPosition:"top",border:false,layout:"fit",items:[d.grid,d.grid1]};for(var b=2;b<10;b++){if(d["grid"+b+"Model"]){a.items.push(d["grid"+b])}}d.items.push(a)}else{d.items.push(d.grid)}d.items=d.items.concat(d.otherItems);d.items.push(d.statusPanel)}this.callParent()}});
Ext.define("Hc_Common.view.BaseBillDetailPageController",{extend:"Hc_Common.view.BaseMultiPageController",alias:"controller.basebilldetailpage",init:function(){var b=this,a=b.getObjList();b.callParent(arguments);try{b.setCommonToobar(a);if(a.commonbill){a.commonbill.store.on("update",b.onBillDataChange,b);a.commonbill.store.on("datachanged",b.onBillDataChange,b)}b.onBindData(b.view.billNo)}catch(c){}},setCommonToobar:function(a){if(!a||a.length<1){return}a.btnSearch.setVisible(false);a.btnExport.setVisible(false);a.btnPrint.setVisible(false);a.btnOther.setVisible(false);a.btnSave.setVisible(false);a.btnAdd.setText("增行");a.btnDelete.setText("删行");for(var b=3;b<7;b++){var c=a["commontoolsp"+b];if(c){c.setVisible(false)}}},setPageStatus:function(c){var f=this,e=f.getObj("commonbill"),b=f.editingList.length>0,a=e.getRecord(),d=f.workObject;c=c||f.getObjList();if(b){c.btnBillPrev.setDisabled(true);c.btnBillNext.setDisabled(true);c.btnBillAudit.setDisabled(true)}else{f.billDirection(false)}c.btnBillNew.setDisabled(b);c.btnBillDel.setDisabled(!d.isCanDelete||e.isAudit);c.btnBillDel.setDisabled(b);c.btnBillPrint.setDisabled(b);c.btnBillExport.setDisabled(b);c.btnBillSave.setDisabled(!b);c.btnDelete.setDisabled(!d.isCanDelete||e.isAudit);if(!e.isAudit&&!b&&a&&f.view.billNo){c.btnBillAudit.setDisabled(false)}c.btnAdd.setDisabled(!d.isCanAdd||d.isReadOnly)},checkAudit:function(){var f=this,d=f.getObjList(),e=d.commonbill,b=e.getRecord();if(!b){return}var a=e.query("textfield,numberfield,datefield,combo"),g=e.subGrid||[],c=b.get("billStatus")>=f.view.auditStatus;e.isAudit=c;if(c){a.forEach(function(h){h.setReadOnly(true)});g.forEach(function(h){if(d[h]){d[h].isReadOnly=true}})}else{a.forEach(function(h){h.setReadOnly(false);if(h.canInput===false){h.setReadOnly(true)}});g.forEach(function(h){if(d[h]){d[h].isReadOnly=false}})}d.btnBillAudit.setDisabled(c)},initAddData:function(b){var a=this;if(!(a.getObj("commonbill").isValid())){return false}b.set("billNo",a.view.billNo);if(a.workObject.hasOrderNo){var c=a.workObject.store,d=(c.max("orderNo")||0)+1;b.set("orderNo",d)}},initAddBill:function(a){},setStatusText:function(c){var e=this,f=e.getViewModel(),g=e.view.ddlBillStatus,b=c.get("billStatus"),d=c.get("billStatusMax");e.checkAudit();if(g){var a=g.store.findExact(g.valueField,b.toString());if(a>-1){b=g.store.getAt(a).get(g.displayField)}if(d==null){d=""}else{a=g.store.findExact(g.valueField,d.toString());if(a>-1){d=g.store.getAt(a).get(g.displayField)}}}f.set("billStatusText",b);f.set("billStatus2Text",d)},onBindData:function(h){var f=this,d=f.getObjList(),e=d.commonbill,b=e.store,c=f.getViewModel(),a=e.modelName,g;if(!a){Hc.alert("没有指定单据的Model",function(){f.onClose(f.view)});return}f.view.billNo=h;if(!h){g=Ext.create(a,{billStatus:f.view.editStatus});b.removeAll();f.initAddBill(g);b.add(g);e.loadRecord(g);c.set("billRow",g);f.setStatusText(g);f.bindSubGrid(e);f.setPageStatus(d);f.bindOtherCt(h);return}b.proxy.extraParams.billNo=h;b.load({callback:function(j,i,k){g=j[0];if(g){e.loadRecord(g);c.set("billRow",g);f.setStatusText(g)}else{Hc.alert("单据编号不存在",function(){f.onClose(f.view)});return}f.bindSubGrid(e);f.setPageStatus(d);f.bindOtherCt(h)}})},bindOtherCt:function(a){},onBillDataChange:function(c){var e=this,b="commonbill",d=e.getObj(b),a=e.getDirtyIndex(c);if(a>-1&&c.getAt(0).modified&&!d.isAudit){Ext.Array.include(e.editingList,b)}else{Ext.Array.remove(e.editingList,b)}e.setPageStatus()},onGridDataChanged:function(a){this.callParent(arguments);this.setPageStatus()},onGrid1DataChanged:function(a){this.callParent(arguments);this.setPageStatus()},onGrid2DataChanged:function(a){this.callParent(arguments);this.setPageStatus()},onGrid3DataChanged:function(a){this.callParent(arguments);this.setPageStatus()},onGrid4DataChanged:function(a){this.callParent(arguments);this.setPageStatus()},onGrid5DataChanged:function(a){this.callParent(arguments);this.setPageStatus()},onGrid6DataChanged:function(a){this.callParent(arguments);this.setPageStatus()},onGrid7DataChanged:function(a){this.callParent(arguments);this.setPageStatus()},onGrid8DataChanged:function(a){this.callParent(arguments);this.setPageStatus()},onGrid9DataChanged:function(a){this.callParent(arguments);this.setPageStatus()},gridIsCanLoad:function(a,c,d){var b=this;if(b.callParent(arguments)===false){return false}if(!b.view.billNo){return false}a.proxy.extraParams.billNo=b.view.billNo},onBtnBillPrevClick:function(a){this.billDirection(-1)},onBtnBillNextClick:function(a){this.billDirection(1)},billDirection:function(i){var f=this,e=f.getObj("btnBillPrev"),b=f.getObj("btnBillNext"),c=f.view.listStore;b.setDisabled(true);e.setDisabled(true);if(!c||c.getCount()<1){return}var h=f.view.billNo,g=c.findExact("billNo",h),a=c.getCount();if(g==-1){g=0}if(i){if(i==1&&g<a-1){g++}else{if(i==-1&&g>0){g--}}h=c.getAt(g).get("billNo");if(h!=f.view.billNo){f.onBindData(h)}}if(g+1<a){b.setDisabled(false)}if(g>0){e.setDisabled(false)}},onBtnBillNewClick:function(a){var b=this;b._idValue="";b.view.billNo=b._idValue;b.onBindData(b._idValue)},onBtnBillDelClick:function(a){var c=this,b=c.getObj("commonbill");if(!c.view.billNo){return}if(b.isAudit){Hc.alert("此单据已审批,不能删除");return}Hc.confirm("确认要删除此单",function(e){if(e=="yes"){var d=c.getDataToSave(b,true);c.saveData({srcObj:b,data:d,btn:a})}})},onBtnBillAuditClick:function(a){var c=this,b=c.getObj("commonbill");if(c.workObject.getStore().getCount()<=0){Hc.alert("单据明细数据为空不允许审核");return}Hc.confirm("确认审批此单据？",function(d){if(d=="yes"){var e={auditModelList:[b.getRecord().data]};c._idValue=c.view.billNo;c.saveData({srcObj:b,data:e,btn:a,url:b.auditUrl})}})},onBtnSaveClick:function(a){var b=this,d,c=b.getObj("commonbill");if(b.editingList.length<1){return}d=b.getDataToSave(c);if(!d){return}d.billType=b.view.billType;d.masterJson.billTypeNo=b.view.billType;if(b.beforeSave(d)===false){return}b._idValue=b.view.billNo;b.saveData({srcObj:c,data:d,btn:a})},afterSaveResetForm:function(a,b){var c=this;c.view.listStore.reload();if(b.btn&&b.btn.reference=="btnBillDel"){c.onClose(b.btn);return}c.view.billNo=c._idValue;c.onBindData(c._idValue)},onBtnBillBackClick:function(a){var b=this;if(b.editingList.length>0){Hc.confirm("数据尚为保存，退出吗？",function(c){if(c=="yes"){b.onClose(a)}})}else{b.onClose(a)}},onClose:function(c){var a=c.up("tabpanel");if(a){var b=a.getActiveTab();a.setActiveTab(0);a.remove(b)}else{var d=c.up("window");if(d){d.close()}}},btnBillOther1Click:function(a){},btnBillOther2Click:function(a){},btnBillOther3Click:function(a){},btnBillOther4Click:function(a){},btnBillOther5Click:function(a){},});
Ext.define("Hc_Common.view.BaseBillDetailPageModel",{extend:"Hc_Common.view.BaseMultiPageModel",alias:"viewmodel.basebilldetialpage",data:{billRow:null,billStatusText:"",billStatus2Text:""}});
Ext.define("Hc_Common.view.BaseBillListPage",{extend:"Hc_Common.view.BaseSimplePage",controller:"basebilllistpage",viewModel:{type:"basebilllistpage"},listTitle:"单据清单",customLayout2:false,gridEditModel:"none",gridReadOnly:true,gridHasMark:true,gridHasCreator:true,gridHasModifier:false,gridHasAuditor:true,dtlName:"",dtlTitle:"单据明细",showModel:"selftab",selftab:{xtype:"tabpanel",reference:"selftab",region:"center",tabPosition:"bottom",layout:"border",tabBar:{hidden:true}},pageType:"billList",initComponent:function(){var b=this;if(!b.dtlName){Hc.alert("没有指定单据的明细类")}b.customLayout=b.customLayout||b.customLayout2;if(b.showModel=="selftab"){b.customLayout=true;var a={xtype:"container",layout:"border",title:b.listTitle,items:[b.toolbar]};if(b.searchItems.length>0){a.items.push(b.searchPanel)}a.items.push(b.grid);a.items=a.items.concat(b.otherItems);b.selftab.items=[a];if(!b.customLayout2){b.items=[b.selftab]}}b.callParent(arguments)}});
Ext.define("Hc_Common.view.BaseBillListPageController",{extend:"Hc_Common.view.BaseSimplePageController",alias:"controller.basebilllistpage",init:function(){var a=this;a.callParent(arguments)},onGridRowDblClick:function(b,a,d,g,f){var c=this;c.showDtlModule(a.get("billNo"))},onBtnAddClick:function(){var a=this;if(!a.canAdd()){Hc.alert("你没有权限新增数据");return}a.showDtlModule("")},showDtlModule:function(b){var j=this,f=(Ext.isEmpty(b)?"new":"edit"),k=j.view,e=k.showModel,g=k.dtlName,h=k.dtlName+f,a=j.workObject||{};if(!g){Hc.alert("没有指定明细的类名");return}var d=j.getObj("ddlBillStatus"),i={xtype:g,billNo:b,pageStatus:f,itemId:h,closable:true,reorderable:true,loadMask:"加载中...",listName:k.xtype,listStore:a.store,ddlBillStatus:d,userRight:k.userRight,moduleRight:k.moduleRight,userCode:k.userCode,userName:k.userName};if(e=="window"){i.width=Ext.getBody().getWidth()*0.8;i.height=Ext.getBody().getHeight()*0.8;j.showInWin(i,{winName:h,title:k.dtlTitle,showBbar:false});return}i.title=k.dtlTitle;if(e=="selftab"){var l=j.getObj("selftab");if(!l){Hc.alert("模块页面布局不正确");return}var c=l.getComponent(h);if(!c){c=l.add(i)}l.setActiveTab(c)}else{if(e=="maintab"){j.showInTab(i,true)}}},onBtnEditClick:function(b){var c=this;if(!c.canEdit()&&c.canAudit()){Hc.alert("你没有权限编辑或审批数据");return}var a=c.getObj("mastergrid").getSelection()[0];if(!a){Hc.alert("没有选择记录");return}c.showDtlModule(a.get("billNo"))},onGridSelectionChange:function(c,b){var a=this.getObj("btnEdit");if(a){a.setDisabled(b==0)}this.callParent(arguments)}});
Ext.define("Hc_Common.view.BaseBillListPageModel",{extend:"Hc_Common.view.BaseSimplePageModel",alias:"viewmodel.basebilllistpage"});
